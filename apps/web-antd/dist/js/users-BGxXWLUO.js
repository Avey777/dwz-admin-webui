var ge=Object.defineProperty,we=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var N=(u,n,i)=>n in u?ge(u,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[n]=i,H=(u,n)=>{for(var i in n||(n={}))Y.call(n,i)&&N(u,i,n[i]);if(R)for(var i of R(n))A.call(n,i)&&N(u,i,n[i]);return u},L=(u,n)=>we(u,_e(n));var J=(u,n)=>{var i={};for(var d in u)Y.call(u,d)&&n.indexOf(d)<0&&(i[d]=u[d]);if(u!=null&&R)for(var d of R(u))n.indexOf(d)<0&&A.call(u,d)&&(i[d]=u[d]);return i};var P=(u,n,i)=>new Promise((d,_)=>{var f=v=>{try{F(i.next(v))}catch(p){_(p)}},y=v=>{try{F(i.throw(v))}catch(p){_(p)}},F=v=>v.done?d(v.value):Promise.resolve(v.value).then(f,y);F((i=i.apply(u,n)).next())});import{a4 as ye,P as h,T as j,a9 as be,aa as D,ab as k,ac as l,x as s,a7 as t,aB as Q,ai as x,av as $,aq as B,F as he,aj as ke,b1 as xe}from"../jse/index-index-Bfp9fVLj.js";import{X as U,bL as X,cj as z,bN as w,bu as Ce}from"./bootstrap-8TZEei42.js";import{C as Z}from"./index-sAHdq1L4.js";import"./index-CNxovIFI.js";import{I,b as E}from"./Password-BTLJaSmc.js";import Se,{SelectOption as G}from"./index-CjPh78nq.js";import"./index-Brf31eMN.js";import{F as K,a as C}from"./index-BJdPPNAb.js";import{_ as Fe}from"./page.vue_vue_type_script_setup_true_lang-BY0axxjX.js";import{S as W}from"./search-Acm0BD4o.js";import{T as Pe}from"./index-Q22sitgt.js";import ee from"./index-BbMMZWu9.js";import{P as Ue}from"./index-SftpmQNt.js";import"./index-d0SnXsRb.js";import"./shallowequal-NoPM3EZB.js";import"./Trigger-DOqqEP9A.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-bo4x4DTi.js";import"./index-D27JxLQ4.js";import"./index-B4u-ZZTz.js";import"./colors-BPXzNSR4.js";import"./collapseMotion-B5MEdO-q.js";import"./slide-CIRZRFAB.js";import"./useRefs-qMOa5Z2N.js";import"./hasIn-DZ2VGsD9.js";import"./isMobile-8sZ0LT6r.js";import"./useMergedState-D4hu3SXC.js";import"./isPlainObject-C6CdBuZO.js";import"./FormItemContext-rLUZDVS8.js";import"./index-hbqzz9bt.js";import"./SearchOutlined-DwCm3gjA.js";import"./statusUtils-Du58bhOV.js";import"./BaseInput-BGap_2jZ.js";import"./EyeOutlined-Dd3Pi4Q1.js";import"./index-_voPasPS.js";import"./DownOutlined-9dNQhNuA.js";import"./CheckOutlined-BM_eCpQE.js";import"./move-DwobPZCz.js";import"./responsiveObserve-DvNweebH.js";import"./useFlexGapSupport-D2tEWaK3.js";import"./debounce-XLPEvZnf.js";import"./index-Citz1j1Z.js";import"./index-MTZpYbOL.js";import"./index-B-LRQwvO.js";import"./index-BSNvJqe7.js";import"./Checkbox-BxPImIEi.js";import"./index-CuO3k1mL.js";const ze={class:"flex items-center justify-between"},Ie={class:"flex items-center space-x-4"},Me={key:0},Re={key:1,class:"text-gray-500"},je={key:2,class:"flex space-x-2"},De=ye({__name:"users",setup(u){const n=h(!1),i=h([]),d=h(!1),_=h(!1),f=h(!1),y=h(null),F=h(),v=h(),p=j({username:"",real_name:"",status:void 0}),g=j({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:r=>`共 ${r} 条`}),m=j({username:"",password:"",real_name:"",email:"",phone:"",status:!0}),b=j({new_password:"",confirm_password:""}),ae={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:50,message:"用户名长度应为3-50字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:50,message:"密码长度应为6-50字符",trigger:"blur"}],real_name:[{max:100,message:"真实姓名不能超过100字符",trigger:"blur"}],email:[{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入有效的手机号码",trigger:"blur"}]},te={new_password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:50,message:"密码长度应为6-50字符",trigger:"blur"}],confirm_password:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(r,e)=>e!==b.new_password?Promise.reject(new Error("两次输入的密码不一致")):Promise.resolve(),trigger:"blur"}]},se=[{title:"用户名",dataIndex:"username",width:150},{title:"真实姓名",dataIndex:"real_name",width:150},{title:"邮箱",dataIndex:"email",width:200,ellipsis:!0},{title:"电话",dataIndex:"phone",width:150},{title:"状态",key:"status",width:80},{title:"最后登录",key:"last_login",width:180},{title:"创建时间",dataIndex:"created_at",width:180,customRender:({text:r})=>V(r)},{title:"操作",key:"actions",width:200,fixed:"right"}],S=()=>P(null,null,function*(){n.value=!0;try{const r={page:g.current,page_size:g.pageSize,username:p.username||void 0,real_name:p.real_name||void 0,status:p.status},e=yield z.getList(r);i.value=e.list,g.total=e.total,g.current=e.page,g.pageSize=e.size}catch(r){w.error("加载数据失败"),console.error("Failed to load users:",r)}finally{n.value=!1}}),M=()=>{g.current=1,S()},re=()=>{p.username="",p.real_name="",p.status=void 0,g.current=1,S()},le=r=>{g.current=r.current,g.pageSize=r.pageSize,S()},oe=()=>{f.value=!1,O(),d.value=!0},ne=r=>{f.value=!0,y.value=r,Object.assign(m,{username:r.username,password:"",real_name:r.real_name,email:r.email,phone:r.phone,status:r.status===1}),d.value=!0},ie=()=>P(null,null,function*(){var e,a;try{yield F.value.validate();const o=L(H({},m),{status:m.status?1:0});if(f.value&&y.value){const r=o,{username:c,password:q}=r,ve=J(r,["username","password"]);yield z.update(y.value.id,ve),w.success("用户更新成功")}else yield z.create(o),w.success("用户创建成功");d.value=!1,S()}catch(o){const c=((a=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:a.message)||(f.value?"更新失败":"创建失败");w.error(c),console.error("Failed to submit user:",o)}}),ue=()=>{d.value=!1,O()},de=r=>P(null,null,function*(){var e,a;try{yield z.remove(r.id),w.success("用户删除成功"),S()}catch(o){const c=((a=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:a.message)||"删除失败";w.error(c),console.error("Failed to delete user:",o)}}),me=(r,e)=>P(null,null,function*(){var a,o;try{yield z.update(r.id,{status:e?1:0}),w.success("状态更新成功"),S()}catch(c){const q=((o=(a=c==null?void 0:c.response)==null?void 0:a.data)==null?void 0:o.message)||"状态更新失败";w.error(q),console.error("Failed to update user status:",c)}}),pe=r=>{y.value=r,T(),_.value=!0},ce=()=>P(null,null,function*(){var r,e;try{yield v.value.validate(),y.value&&(yield z.resetPassword(y.value.id,{new_password:b.new_password}),w.success("密码重置成功"),_.value=!1)}catch(a){const o=((e=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:e.message)||"密码重置失败";w.error(o),console.error("Failed to reset password:",a)}}),fe=()=>{_.value=!1,T()},O=()=>{Object.assign(m,{username:"",password:"",real_name:"",email:"",phone:"",status:!0})},T=()=>{Object.assign(b,{new_password:"",confirm_password:""})},V=r=>xe(r).format("YYYY-MM-DD HH:mm:ss");return be(()=>{S()}),(r,e)=>(k(),D(t(Fe),{description:"管理系统用户，包括创建、编辑、删除用户以及重置密码等功能",title:"用户管理"},{default:l(()=>[s(t(Z),{class:"mb-4",title:"搜索筛选"},{default:l(()=>[Q("div",ze,[Q("div",Ie,[s(t(I),{value:p.username,"onUpdate:value":e[0]||(e[0]=a=>p.username=a),placeholder:"搜索用户名",style:{width:"200px"},onPressEnter:M},{prefix:l(()=>[s(t(W),{class:"h-4 w-4"})]),_:1},8,["value"]),s(t(I),{value:p.real_name,"onUpdate:value":e[1]||(e[1]=a=>p.real_name=a),placeholder:"搜索真实姓名",style:{width:"200px"},onPressEnter:M},{prefix:l(()=>[s(t(W),{class:"h-4 w-4"})]),_:1},8,["value"]),s(t(Se),{value:p.status,"onUpdate:value":e[2]||(e[2]=a=>p.status=a),placeholder:"选择状态",style:{width:"150px"},"allow-clear":"",onChange:M},{default:l(()=>[s(t(G),{value:1},{default:l(()=>e[13]||(e[13]=[x("启用")])),_:1}),s(t(G),{value:0},{default:l(()=>e[14]||(e[14]=[x("禁用")])),_:1})]),_:1},8,["value"]),s(t(U),{type:"primary",onClick:M,loading:n.value},{default:l(()=>e[15]||(e[15]=[x(" 搜索 ")])),_:1},8,["loading"]),s(t(U),{onClick:re},{default:l(()=>e[16]||(e[16]=[x("重置")])),_:1})]),s(t(U),{type:"primary",onClick:oe},{default:l(()=>e[17]||(e[17]=[x("创建用户")])),_:1})])]),_:1}),s(t(Z),{title:"用户列表"},{default:l(()=>[s(t(Pe),{columns:se,"data-source":i.value,loading:n.value,pagination:g,"row-key":"id",onChange:le},{bodyCell:l(({column:a,record:o})=>[a.key==="status"?(k(),D(t(ee),{key:0,checked:o.status===1,onChange:c=>me(o,!!c)},null,8,["checked","onChange"])):a.key==="last_login"?(k(),$(he,{key:1},[o.last_login?(k(),$("span",Me,ke(V(o.last_login)),1)):(k(),$("span",Re,"从未登录"))],64)):a.key==="actions"?(k(),$("div",je,[s(t(U),{size:"small",type:"link",onClick:c=>ne(o)},{default:l(()=>e[18]||(e[18]=[x(" 编辑 ")])),_:2},1032,["onClick"]),s(t(U),{size:"small",type:"link",onClick:c=>pe(o)},{default:l(()=>e[19]||(e[19]=[x(" 重置密码 ")])),_:2},1032,["onClick"]),s(t(Ue),{title:"确定要删除这个用户吗？",onConfirm:c=>de(o)},{default:l(()=>[s(t(U),{size:"small",type:"link",danger:""},{default:l(()=>e[20]||(e[20]=[x("删除")])),_:1})]),_:2},1032,["onConfirm"])])):B("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),s(t(X),{open:d.value,"onUpdate:open":e[9]||(e[9]=a=>d.value=a),title:f.value?"编辑用户":"创建用户",width:"600px",onOk:ie,onCancel:ue},{default:l(()=>[s(t(K),{ref_key:"formRef",ref:F,model:m,rules:ae,layout:"vertical"},{default:l(()=>[s(t(C),{label:"用户名",name:"username"},{default:l(()=>[s(t(I),{value:m.username,"onUpdate:value":e[3]||(e[3]=a=>m.username=a),placeholder:"请输入用户名",disabled:f.value},null,8,["value","disabled"])]),_:1}),f.value?B("",!0):(k(),D(t(C),{key:0,label:"密码",name:"password"},{default:l(()=>[s(t(E),{value:m.password,"onUpdate:value":e[4]||(e[4]=a=>m.password=a),placeholder:"请输入密码"},null,8,["value"])]),_:1})),s(t(C),{label:"真实姓名",name:"real_name"},{default:l(()=>[s(t(I),{value:m.real_name,"onUpdate:value":e[5]||(e[5]=a=>m.real_name=a),placeholder:"请输入真实姓名"},null,8,["value"])]),_:1}),s(t(C),{label:"邮箱",name:"email"},{default:l(()=>[s(t(I),{value:m.email,"onUpdate:value":e[6]||(e[6]=a=>m.email=a),placeholder:"请输入邮箱地址"},null,8,["value"])]),_:1}),s(t(C),{label:"电话",name:"phone"},{default:l(()=>[s(t(I),{value:m.phone,"onUpdate:value":e[7]||(e[7]=a=>m.phone=a),placeholder:"请输入电话号码"},null,8,["value"])]),_:1}),f.value?(k(),D(t(C),{key:1,label:"状态",name:"status"},{default:l(()=>[s(t(ee),{checked:m.status,"onUpdate:checked":e[8]||(e[8]=a=>m.status=a),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])]),_:1})):B("",!0)]),_:1},8,["model"])]),_:1},8,["open","title"]),s(t(X),{open:_.value,"onUpdate:open":e[12]||(e[12]=a=>_.value=a),title:"重置用户密码",width:"400px",onOk:ce,onCancel:fe},{default:l(()=>[s(t(K),{ref_key:"passwordFormRef",ref:v,model:b,rules:te,layout:"vertical"},{default:l(()=>[s(t(C),{label:"新密码",name:"new_password"},{default:l(()=>[s(t(E),{value:b.new_password,"onUpdate:value":e[10]||(e[10]=a=>b.new_password=a),placeholder:"请输入新密码"},null,8,["value"])]),_:1}),s(t(C),{label:"确认密码",name:"confirm_password"},{default:l(()=>[s(t(E),{value:b.confirm_password,"onUpdate:value":e[11]||(e[11]=a=>b.confirm_password=a),placeholder:"请确认新密码"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])]),_:1}))}}),Ia=Ce(De,[["__scopeId","data-v-ddcbde2e"]]);export{Ia as default};
