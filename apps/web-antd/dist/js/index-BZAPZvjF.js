var Ue=Object.defineProperty,Se=Object.defineProperties;var De=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,Re=Object.prototype.propertyIsEnumerable;var K=(v,n,r)=>n in v?Ue(v,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):v[n]=r,W=(v,n)=>{for(var r in n||(n={}))Le.call(n,r)&&K(v,r,n[r]);if(G)for(var r of G(n))Re.call(n,r)&&K(v,r,n[r]);return v},Z=(v,n)=>Se(v,De(n));var y=(v,n,r)=>new Promise((V,B)=>{var g=c=>{try{S(r.next(c))}catch(D){B(D)}},U=c=>{try{S(r.throw(c))}catch(D){B(D)}},S=c=>c.done?V(c.value):Promise.resolve(c.value).then(g,U);S((r=r.apply(v,n)).next())});import{X as R,bL as j,c1 as I,bN as p,ce as ee,bu as Ie}from"./bootstrap-8TZEei42.js";import{a4 as ze,P as f,T as M,a9 as Be,aa as z,ab as d,ac as o,x as i,a7 as a,av as _,F as O,aC as Y,ai as h,aj as x,aq as P,aB as u,b1 as A}from"../jse/index-index-Bfp9fVLj.js";import{C as te}from"./index-sAHdq1L4.js";import ae from"./index-CFcASXFh.js";import{Textarea as le}from"./index-CNxovIFI.js";import{I as N}from"./Password-BTLJaSmc.js";import{S as Te}from"./search-Acm0BD4o.js";import E,{SelectOption as q}from"./index-CjPh78nq.js";import{T as ie}from"./index-Q22sitgt.js";import{C as $e}from"./copy-BzImV03D.js";import{T as Ve}from"./index-B4u-ZZTz.js";import oe from"./index-BbMMZWu9.js";import{P as Fe}from"./index-SftpmQNt.js";import"./index-Brf31eMN.js";import{F as se,a as k}from"./index-BJdPPNAb.js";import{D as Me}from"./dayjs-B7d_3Ic4.js";import{_ as Oe}from"./page.vue_vue_type_script_setup_true_lang-BY0axxjX.js";import"./index-d0SnXsRb.js";import"./shallowequal-NoPM3EZB.js";import"./Trigger-DOqqEP9A.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-bo4x4DTi.js";import"./index-D27JxLQ4.js";import"./collapseMotion-B5MEdO-q.js";import"./slide-CIRZRFAB.js";import"./useRefs-qMOa5Z2N.js";import"./hasIn-DZ2VGsD9.js";import"./isMobile-8sZ0LT6r.js";import"./useMergedState-D4hu3SXC.js";import"./isPlainObject-C6CdBuZO.js";import"./useFlexGapSupport-D2tEWaK3.js";import"./FormItemContext-rLUZDVS8.js";import"./index-hbqzz9bt.js";import"./SearchOutlined-DwCm3gjA.js";import"./statusUtils-Du58bhOV.js";import"./BaseInput-BGap_2jZ.js";import"./EyeOutlined-Dd3Pi4Q1.js";import"./index-_voPasPS.js";import"./DownOutlined-9dNQhNuA.js";import"./CheckOutlined-BM_eCpQE.js";import"./move-DwobPZCz.js";import"./index-Citz1j1Z.js";import"./index-MTZpYbOL.js";import"./index-B-LRQwvO.js";import"./responsiveObserve-DvNweebH.js";import"./index-BSNvJqe7.js";import"./Checkbox-BxPImIEi.js";import"./colors-BPXzNSR4.js";import"./index-CuO3k1mL.js";import"./debounce-XLPEvZnf.js";import"./index-C4ppseFx.js";import"./index-BfQKXdoT.js";const Pe={key:0,class:"flex items-center space-x-2"},Ne=["href"],je=["href"],Ye={key:0},Ae={key:1,class:"text-gray-500"},Ee={key:4,class:"flex space-x-2"},qe={key:0,class:"mt-1 text-sm text-gray-500"},He={key:0},Je={class:"mb-4 grid grid-cols-4 gap-4"},Qe={class:"text-center"},Xe={class:"text-2xl font-bold text-blue-600"},Ge={class:"text-center"},Ke={class:"text-2xl font-bold text-green-600"},We={class:"text-center"},Ze={class:"text-2xl font-bold text-orange-600"},et={class:"text-center"},tt={class:"text-2xl font-bold text-purple-600"},at=ze({__name:"index",setup(v){const n=f(!1),r=f([]),V=f([]),B=f([]),g=f(!1),U=f(!1),S=f(!1),c=f(!1),D=f(null),L=f(null),H=f(),b=M({keyword:"",domain:void 0}),w=M({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:l=>`共 ${l} 条`}),s=M({original_url:"",domain:void 0,custom_code:"",title:"",description:"",expire_at:void 0,is_active:!0}),T=M({domain:void 0}),F=f(""),ne={original_url:[{required:!0,message:"请输入原始URL",trigger:"blur"}]},re=[{title:"短网址",key:"short_url",dataIndex:"short_url",width:200},{title:"原始URL",key:"original_url",dataIndex:"original_url",width:250},{title:"标题",dataIndex:"title",width:150},{title:"点击数",dataIndex:"click_count",width:80},{title:"状态",key:"is_active",width:80},{title:"过期时间",key:"expire_at",width:120},{title:"创建时间",dataIndex:"created_at",width:120,customRender:({text:l})=>X(l)},{title:"操作",key:"actions",width:150,fixed:"right"}],de=[{title:"日期",dataIndex:"date"},{title:"点击数",dataIndex:"click_count"}],C=()=>y(null,null,function*(){n.value=!0;try{const l={page:w.current,page_size:w.pageSize,keyword:b.keyword,domain:b.domain},e=yield I.getList(l);r.value=e.list,w.total=e.total}catch(l){p.error("加载数据失败")}finally{n.value=!1}}),ue=()=>y(null,null,function*(){try{const[l,e]=yield Promise.all([ee.getList(),ee.getActiveList()]);V.value=l.list,B.value=e.list}catch(l){p.error("加载域名失败")}}),J=()=>{w.current=1,C()},ce=()=>{b.keyword="",b.domain=void 0,w.current=1,C()},pe=l=>{w.current=l.current,w.pageSize=l.pageSize,C()},me=()=>{c.value=!1,Q(),g.value=!0},ve=l=>{c.value=!0,D.value=l,Object.assign(s,{original_url:l.original_url,domain:l.domain,custom_code:"",title:l.title,description:l.description,expire_at:l.expire_at?A(l.expire_at):void 0,is_active:l.is_active}),g.value=!0},fe=()=>y(null,null,function*(){try{yield H.value.validate();const l=Z(W({},s),{expire_at:s.expire_at?A(s.expire_at).toISOString():null});c.value&&D.value?(yield I.update(D.value.id,l),p.success("更新成功")):(yield I.create(l),p.success("创建成功")),g.value=!1,C()}catch(l){p.error(c.value?"更新失败":"创建失败")}}),_e=()=>{g.value=!1,Q()},xe=l=>y(null,null,function*(){try{yield I.remove(l.id),p.success("删除成功"),C()}catch(e){p.error("删除失败")}}),ye=(l,e)=>y(null,null,function*(){try{yield I.update(l.id,{is_active:e}),p.success("状态更新成功"),C()}catch(t){p.error("状态更新失败")}}),he=()=>{T.domain=void 0,F.value="",U.value=!0},ke=()=>y(null,null,function*(){try{const l=F.value.split(`
`).map(t=>t.trim()).filter(Boolean);if(l.length===0){p.error("请输入至少一个URL");return}const e=yield I.batchCreate({urls:l,domain:T.domain});p.success(`成功创建 ${e.success.length} 个短网址`),e.failed.length>0&&p.warning(`失败 ${e.failed.length} 个`),U.value=!1,C()}catch(l){p.error("批量创建失败")}}),ge=()=>{U.value=!1},be=l=>y(null,null,function*(){try{const e=yield I.getStatistics(l.id,30);L.value=e,S.value=!0}catch(e){p.error("获取统计数据失败")}}),we=l=>y(null,null,function*(){try{yield navigator.clipboard.writeText(l),p.success("复制成功")}catch(e){p.error("复制失败")}}),Q=()=>{Object.assign(s,{original_url:"",domain:void 0,custom_code:"",title:"",description:"",expire_at:null,is_active:!0})},Ce=(l,e=50)=>l.length>e?`${l.slice(0,Math.max(0,e))}...`:l,X=l=>A(l).format("YYYY-MM-DD HH:mm");return Be(()=>{C(),ue()}),(l,e)=>(d(),z(a(Oe),{description:"管理和监控您的短网址，支持批量创建、统计分析等功能",title:"短网址管理"},{default:o(()=>[i(a(te),{class:"mb-4"},{extra:o(()=>[i(a(ae),null,{default:o(()=>[i(a(R),{onClick:he},{default:o(()=>e[14]||(e[14]=[h("批量创建")])),_:1}),i(a(R),{type:"primary",onClick:me},{default:o(()=>e[15]||(e[15]=[h("创建短网址")])),_:1})]),_:1})]),default:o(()=>[i(a(ae),{class:"mb-4"},{default:o(()=>[i(a(N),{value:b.keyword,"onUpdate:value":e[0]||(e[0]=t=>b.keyword=t),placeholder:"搜索URL、标题或描述",style:{width:"300px"},onChange:J},{prefix:o(()=>[i(a(Te),{class:"h-4 w-4"})]),_:1},8,["value"]),i(a(E),{value:b.domain,"onUpdate:value":e[1]||(e[1]=t=>b.domain=t),placeholder:"选择域名",style:{width:"200px"},"allow-clear":"",onChange:J},{default:o(()=>[(d(!0),_(O,null,Y(V.value,t=>(d(),z(a(q),{key:t.id,value:t.domain},{default:o(()=>[h(x(t.domain),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),i(a(R),{onClick:ce},{default:o(()=>e[16]||(e[16]=[h("重置")])),_:1})]),_:1})]),_:1}),i(a(te),{title:"短网址列表"},{default:o(()=>[i(a(ie),{columns:re,"data-source":r.value,loading:n.value,pagination:w,"row-key":"id",onChange:pe},{bodyCell:o(({column:t,record:m})=>[t.key==="short_url"?(d(),_("div",Pe,[u("a",{href:m.short_url,target:"_blank",class:"text-blue-600 hover:text-blue-800"},x(m.short_url),9,Ne),i(a(R),{size:"small",type:"link",onClick:$=>we(m.short_url)},{default:o(()=>[i(a($e),{class:"h-4 w-4"})]),_:2},1032,["onClick"])])):t.key==="original_url"?(d(),z(a(Ve),{key:1,title:m.original_url},{default:o(()=>[u("a",{href:m.original_url,target:"_blank",class:"text-blue-600 hover:text-blue-800"},x(Ce(m.original_url)),9,je)]),_:2},1032,["title"])):t.key==="is_active"?(d(),z(a(oe),{key:2,checked:m.is_active,onChange:$=>ye(m,!!$)},null,8,["checked","onChange"])):t.key==="expire_at"?(d(),_(O,{key:3},[m.expire_at?(d(),_("span",Ye,x(X(m.expire_at)),1)):(d(),_("span",Ae,"永不过期"))],64)):t.key==="actions"?(d(),_("div",Ee,[i(a(R),{size:"small",type:"link",onClick:$=>be(m)},{default:o(()=>e[17]||(e[17]=[h(" 统计 ")])),_:2},1032,["onClick"]),i(a(R),{size:"small",type:"link",onClick:$=>ve(m)},{default:o(()=>e[18]||(e[18]=[h(" 编辑 ")])),_:2},1032,["onClick"]),i(a(Fe),{title:"确定要删除这个短网址吗？",onConfirm:$=>xe(m)},{default:o(()=>[i(a(R),{size:"small",type:"link",danger:""},{default:o(()=>e[19]||(e[19]=[h("删除")])),_:1})]),_:2},1032,["onConfirm"])])):P("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),i(a(j),{open:g.value,"onUpdate:open":e[9]||(e[9]=t=>g.value=t),title:c.value?"编辑短网址":"创建短网址",width:"600px",onOk:fe,onCancel:_e},{default:o(()=>[i(a(se),{ref_key:"formRef",ref:H,model:s,rules:ne,layout:"vertical"},{default:o(()=>[i(a(k),{label:"原始URL",name:"original_url"},{default:o(()=>[i(a(N),{value:s.original_url,"onUpdate:value":e[2]||(e[2]=t=>s.original_url=t),placeholder:"请输入原始URL"},null,8,["value"])]),_:1}),i(a(k),{label:"域名",name:"domain"},{default:o(()=>[i(a(E),{value:s.domain,"onUpdate:value":e[3]||(e[3]=t=>s.domain=t),placeholder:"选择域名","allow-clear":""},{default:o(()=>[(d(!0),_(O,null,Y(B.value,t=>(d(),z(a(q),{key:t.id,value:t.domain},{default:o(()=>[h(x(t.domain),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),i(a(k),{label:"自定义短代码",name:"custom_code"},{default:o(()=>[i(a(N),{value:s.custom_code,"onUpdate:value":e[4]||(e[4]=t=>s.custom_code=t),placeholder:"留空则自动生成",disabled:c.value},null,8,["value","disabled"]),c.value?(d(),_("div",qe," 编辑时不可修改短代码 ")):P("",!0)]),_:1}),i(a(k),{label:"标题",name:"title"},{default:o(()=>[i(a(N),{value:s.title,"onUpdate:value":e[5]||(e[5]=t=>s.title=t),placeholder:"可选"},null,8,["value"])]),_:1}),i(a(k),{label:"描述",name:"description"},{default:o(()=>[i(a(le),{value:s.description,"onUpdate:value":e[6]||(e[6]=t=>s.description=t),placeholder:"可选",rows:3},null,8,["value"])]),_:1}),i(a(k),{label:"过期时间",name:"expire_at"},{default:o(()=>[i(a(Me),{value:s.expire_at,"onUpdate:value":e[7]||(e[7]=t=>s.expire_at=t),"show-time":"",placeholder:"选择过期时间，留空则永不过期",style:{width:"100%"}},null,8,["value"])]),_:1}),c.value?(d(),z(a(k),{key:0,label:"状态",name:"is_active"},{default:o(()=>[i(a(oe),{checked:s.is_active,"onUpdate:checked":e[8]||(e[8]=t=>s.is_active=t),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])]),_:1})):P("",!0)]),_:1},8,["model"])]),_:1},8,["open","title"]),i(a(j),{open:U.value,"onUpdate:open":e[12]||(e[12]=t=>U.value=t),title:"批量创建短网址",width:"600px",onOk:ke,onCancel:ge},{default:o(()=>[i(a(se),{model:T,layout:"vertical"},{default:o(()=>[i(a(k),{label:"域名"},{default:o(()=>[i(a(E),{value:T.domain,"onUpdate:value":e[10]||(e[10]=t=>T.domain=t),placeholder:"选择域名","allow-clear":""},{default:o(()=>[(d(!0),_(O,null,Y(B.value,t=>(d(),z(a(q),{key:t.id,value:t.domain},{default:o(()=>[h(x(t.domain),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),i(a(k),{label:"URL列表"},{default:o(()=>[i(a(le),{value:F.value,"onUpdate:value":e[11]||(e[11]=t=>F.value=t),placeholder:"每行一个URL",rows:10},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),i(a(j),{open:S.value,"onUpdate:open":e[13]||(e[13]=t=>S.value=t),title:"短网址统计",width:"800px",footer:null},{default:o(()=>[L.value?(d(),_("div",He,[u("div",Je,[u("div",Qe,[u("div",Xe,x(L.value.total_clicks),1),e[20]||(e[20]=u("div",{class:"text-gray-500"},"总点击数",-1))]),u("div",Ge,[u("div",Ke,x(L.value.today_clicks),1),e[21]||(e[21]=u("div",{class:"text-gray-500"},"今日点击",-1))]),u("div",We,[u("div",Ze,x(L.value.week_clicks),1),e[22]||(e[22]=u("div",{class:"text-gray-500"},"本周点击",-1))]),u("div",et,[u("div",tt,x(L.value.month_clicks),1),e[23]||(e[23]=u("div",{class:"text-gray-500"},"本月点击",-1))])]),u("div",null,[e[24]||(e[24]=u("h3",{class:"mb-2 text-lg font-semibold"},"每日统计",-1)),i(a(ie),{columns:de,"data-source":L.value.daily_statistics,pagination:!1,size:"small"},null,8,["data-source"])])])):P("",!0)]),_:1},8,["open"])]),_:1}))}}),la=Ie(at,[["__scopeId","data-v-6c30932f"]]);export{la as default};
