var N=(M,w,y)=>new Promise((T,s)=>{var u=p=>{try{C(y.next(p))}catch(v){s(v)}},m=p=>{try{C(y.throw(p))}catch(v){s(v)}},C=p=>p.done?T(p.value):Promise.resolve(p.value).then(u,m);C((y=y.apply(M,w)).next())});import{a4 as G,P as S,T as O,a9 as $,aa as Y,ab as _,ac as o,x as a,a7 as t,aB as f,ai as l,av as x,aq as D,aj as n,aV as V,b1 as P}from"../jse/index-index-Bfp9fVLj.js";import{X as I,bL as F,ch as Q,bN as X,bu as h}from"./bootstrap-8TZEei42.js";import{C as L}from"./index-sAHdq1L4.js";import"./index-CNxovIFI.js";import{I as K}from"./Password-BTLJaSmc.js";import E,{SelectOption as i}from"./index-CjPh78nq.js";import{D as J}from"./dayjs-B7d_3Ic4.js";import W from"./index-CFcASXFh.js";import{T as k}from"./index-BfQKXdoT.js";import"./index-Brf31eMN.js";import{D as Z,a as g}from"./index-DG3zxYow.js";import{_ as c}from"./page.vue_vue_type_script_setup_true_lang-BY0axxjX.js";import{S as ee}from"./search-Acm0BD4o.js";import{T as te}from"./index-Q22sitgt.js";import"./index-d0SnXsRb.js";import"./shallowequal-NoPM3EZB.js";import"./Trigger-DOqqEP9A.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-bo4x4DTi.js";import"./index-D27JxLQ4.js";import"./index-B4u-ZZTz.js";import"./colors-BPXzNSR4.js";import"./collapseMotion-B5MEdO-q.js";import"./slide-CIRZRFAB.js";import"./useRefs-qMOa5Z2N.js";import"./hasIn-DZ2VGsD9.js";import"./isMobile-8sZ0LT6r.js";import"./useMergedState-D4hu3SXC.js";import"./isPlainObject-C6CdBuZO.js";import"./FormItemContext-rLUZDVS8.js";import"./index-hbqzz9bt.js";import"./SearchOutlined-DwCm3gjA.js";import"./statusUtils-Du58bhOV.js";import"./BaseInput-BGap_2jZ.js";import"./EyeOutlined-Dd3Pi4Q1.js";import"./index-_voPasPS.js";import"./DownOutlined-9dNQhNuA.js";import"./CheckOutlined-BM_eCpQE.js";import"./move-DwobPZCz.js";import"./index-C4ppseFx.js";import"./useFlexGapSupport-D2tEWaK3.js";import"./responsiveObserve-DvNweebH.js";import"./index-Citz1j1Z.js";import"./index-MTZpYbOL.js";import"./index-B-LRQwvO.js";import"./index-BSNvJqe7.js";import"./Checkbox-BxPImIEi.js";import"./index-CuO3k1mL.js";import"./debounce-XLPEvZnf.js";const oe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4"},ae={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},le={key:4,class:"flex space-x-2"},re={key:0},se={class:"mt-4"},ue={class:"p-2 bg-gray-50 rounded text-sm"},ie={key:0,class:"mt-4"},de={class:"p-3 bg-gray-50 rounded text-xs overflow-auto max-h-40"},ne={key:1,class:"mt-4"},me={class:"p-3 bg-gray-50 rounded text-xs overflow-auto max-h-40"},pe={key:2,class:"mt-4"},ve={class:"p-3 bg-red-50 border border-red-200 rounded text-sm text-red-800"},fe=G({__name:"logs",setup(M){const w=S(!1),y=S([]),T=S(!1),s=S(null),u=O({username:"",operation:void 0,resource:void 0,method:void 0,status:void 0,start_time:void 0,end_time:void 0}),m=O({current:1,pageSize:20,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:r=>`共 ${r} 条`}),C=[{title:"操作时间",dataIndex:"created_at",width:150,customRender:({text:r})=>U(r),sorter:!0},{title:"用户",dataIndex:"username",width:120},{title:"操作",dataIndex:"operation",width:120,ellipsis:!0},{title:"资源",dataIndex:"resource",width:100},{title:"方法",key:"method",width:80},{title:"路径",dataIndex:"path",width:200,ellipsis:!0},{title:"状态码",key:"response_code",width:80},{title:"执行时间",key:"execute_time",width:100,sorter:!0},{title:"状态",key:"status",width:80},{title:"IP",dataIndex:"ip",width:120},{title:"操作",key:"actions",width:80,fixed:"right"}],p=()=>N(null,null,function*(){w.value=!0;try{const r={page:m.current,page_size:m.pageSize,username:u.username,operation:u.operation,resource:u.resource,method:u.method,status:u.status,start_time:u.start_time?P(u.start_time).format("YYYY-MM-DD HH:mm:ss"):void 0,end_time:u.end_time?P(u.end_time).format("YYYY-MM-DD HH:mm:ss"):void 0},e=yield Q.getList(r);y.value=e.list,m.total=e.pagination.total,m.current=e.pagination.page,m.pageSize=e.pagination.page_size}catch(r){X.error("加载数据失败"),console.error("Failed to load logs:",r)}finally{w.value=!1}}),v=()=>{m.current=1,p()},R=()=>{Object.assign(u,{username:"",operation:void 0,resource:void 0,method:void 0,status:void 0,start_time:void 0,end_time:void 0}),m.current=1,p()},j=(r,e,d)=>{m.current=r.current,m.pageSize=r.pageSize,p()},q=r=>{s.value=r,T.value=!0},B=r=>({GET:"blue",POST:"green",PUT:"orange",DELETE:"red"})[r]||"default",z=r=>r>=200&&r<300?"green":r>=300&&r<400?"blue":r>=400&&r<500?"orange":r>=500?"red":"default",H=r=>r<100?"text-green-600":r<500?"text-yellow-600":r<1e3?"text-orange-600":"text-red-600",U=r=>P(r).format("MM-DD HH:mm:ss"),A=r=>{try{const e=JSON.parse(r);return JSON.stringify(e,null,2)}catch(e){return r}};return $(()=>{p()}),(r,e)=>(_(),Y(t(c),{description:"查看系统操作日志，包括用户操作记录、API调用详情等信息",title:"操作日志"},{default:o(()=>[a(t(L),{class:"mb-4",title:"搜索筛选"},{default:o(()=>[f("div",oe,[a(t(K),{value:u.username,"onUpdate:value":e[0]||(e[0]=d=>u.username=d),placeholder:"搜索用户名",onPressEnter:v},{prefix:o(()=>[a(t(ee),{class:"h-4 w-4"})]),_:1},8,["value"]),a(t(E),{value:u.operation,"onUpdate:value":e[1]||(e[1]=d=>u.operation=d),placeholder:"选择操作类型","allow-clear":"",onChange:v},{default:o(()=>[a(t(i),{value:"创建短网址"},{default:o(()=>e[8]||(e[8]=[l("创建短网址")])),_:1}),a(t(i),{value:"更新短网址"},{default:o(()=>e[9]||(e[9]=[l("更新短网址")])),_:1}),a(t(i),{value:"删除短网址"},{default:o(()=>e[10]||(e[10]=[l("删除短网址")])),_:1}),a(t(i),{value:"创建域名"},{default:o(()=>e[11]||(e[11]=[l("创建域名")])),_:1}),a(t(i),{value:"更新域名"},{default:o(()=>e[12]||(e[12]=[l("更新域名")])),_:1}),a(t(i),{value:"删除域名"},{default:o(()=>e[13]||(e[13]=[l("删除域名")])),_:1}),a(t(i),{value:"创建用户"},{default:o(()=>e[14]||(e[14]=[l("创建用户")])),_:1}),a(t(i),{value:"更新用户"},{default:o(()=>e[15]||(e[15]=[l("更新用户")])),_:1}),a(t(i),{value:"删除用户"},{default:o(()=>e[16]||(e[16]=[l("删除用户")])),_:1}),a(t(i),{value:"创建AB测试"},{default:o(()=>e[17]||(e[17]=[l("创建AB测试")])),_:1}),a(t(i),{value:"更新AB测试"},{default:o(()=>e[18]||(e[18]=[l("更新AB测试")])),_:1}),a(t(i),{value:"删除AB测试"},{default:o(()=>e[19]||(e[19]=[l("删除AB测试")])),_:1}),a(t(i),{value:"用户登录"},{default:o(()=>e[20]||(e[20]=[l("用户登录")])),_:1}),a(t(i),{value:"用户登出"},{default:o(()=>e[21]||(e[21]=[l("用户登出")])),_:1})]),_:1},8,["value"]),a(t(E),{value:u.resource,"onUpdate:value":e[2]||(e[2]=d=>u.resource=d),placeholder:"选择资源类型","allow-clear":"",onChange:v},{default:o(()=>[a(t(i),{value:"short_link"},{default:o(()=>e[22]||(e[22]=[l("短网址")])),_:1}),a(t(i),{value:"domain"},{default:o(()=>e[23]||(e[23]=[l("域名")])),_:1}),a(t(i),{value:"user"},{default:o(()=>e[24]||(e[24]=[l("用户")])),_:1}),a(t(i),{value:"ab_test"},{default:o(()=>e[25]||(e[25]=[l("AB测试")])),_:1}),a(t(i),{value:"token"},{default:o(()=>e[26]||(e[26]=[l("Token")])),_:1}),a(t(i),{value:"auth"},{default:o(()=>e[27]||(e[27]=[l("认证")])),_:1})]),_:1},8,["value"]),a(t(E),{value:u.method,"onUpdate:value":e[3]||(e[3]=d=>u.method=d),placeholder:"选择HTTP方法","allow-clear":"",onChange:v},{default:o(()=>[a(t(i),{value:"GET"},{default:o(()=>e[28]||(e[28]=[l("GET")])),_:1}),a(t(i),{value:"POST"},{default:o(()=>e[29]||(e[29]=[l("POST")])),_:1}),a(t(i),{value:"PUT"},{default:o(()=>e[30]||(e[30]=[l("PUT")])),_:1}),a(t(i),{value:"DELETE"},{default:o(()=>e[31]||(e[31]=[l("DELETE")])),_:1})]),_:1},8,["value"])]),f("div",ae,[a(t(E),{value:u.status,"onUpdate:value":e[4]||(e[4]=d=>u.status=d),placeholder:"选择状态","allow-clear":"",onChange:v},{default:o(()=>[a(t(i),{value:1},{default:o(()=>e[32]||(e[32]=[l("成功")])),_:1}),a(t(i),{value:0},{default:o(()=>e[33]||(e[33]=[l("失败")])),_:1})]),_:1},8,["value"]),a(t(J),{value:u.start_time,"onUpdate:value":e[5]||(e[5]=d=>u.start_time=d),placeholder:"开始时间","show-time":"",format:"YYYY-MM-DD HH:mm:ss",onChange:v},null,8,["value"]),a(t(J),{value:u.end_time,"onUpdate:value":e[6]||(e[6]=d=>u.end_time=d),placeholder:"结束时间","show-time":"",format:"YYYY-MM-DD HH:mm:ss",onChange:v},null,8,["value"])]),a(t(W),null,{default:o(()=>[a(t(I),{onClick:R},{default:o(()=>e[34]||(e[34]=[l("重置")])),_:1}),a(t(I),{type:"primary",onClick:v},{default:o(()=>e[35]||(e[35]=[l("查询")])),_:1})]),_:1})]),_:1}),a(t(L),{title:"日志列表"},{default:o(()=>[a(t(te),{columns:C,"data-source":y.value,loading:w.value,pagination:m,"row-key":"id",onChange:j,size:"small"},{bodyCell:o(({column:d,record:b})=>[d.key==="status"?(_(),Y(t(k),{key:0,color:b.status===1?"green":"red"},{default:o(()=>[l(n(b.status===1?"成功":"失败"),1)]),_:2},1032,["color"])):d.key==="method"?(_(),Y(t(k),{key:1,color:B(b.method)},{default:o(()=>[l(n(b.method),1)]),_:2},1032,["color"])):d.key==="response_code"?(_(),Y(t(k),{key:2,color:z(b.response_code)},{default:o(()=>[l(n(b.response_code),1)]),_:2},1032,["color"])):d.key==="execute_time"?(_(),x("span",{key:3,class:V(H(b.execute_time))},n(b.execute_time)+"ms ",3)):d.key==="actions"?(_(),x("div",le,[a(t(I),{size:"small",type:"link",onClick:ge=>q(b)},{default:o(()=>e[36]||(e[36]=[l(" 详情 ")])),_:2},1032,["onClick"])])):D("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),a(t(F),{open:T.value,"onUpdate:open":e[7]||(e[7]=d=>T.value=d),title:"操作日志详情",width:"800px",footer:null},{default:o(()=>[s.value?(_(),x("div",re,[a(t(Z),{column:2,bordered:"",size:"small"},{default:o(()=>[a(t(g),{label:"操作用户"},{default:o(()=>[l(n(s.value.username),1)]),_:1}),a(t(g),{label:"操作类型"},{default:o(()=>[l(n(s.value.operation),1)]),_:1}),a(t(g),{label:"资源类型"},{default:o(()=>[l(n(s.value.resource),1)]),_:1}),a(t(g),{label:"资源ID"},{default:o(()=>[l(n(s.value.resource_id),1)]),_:1}),a(t(g),{label:"HTTP方法"},{default:o(()=>[a(t(k),{color:B(s.value.method)},{default:o(()=>[l(n(s.value.method),1)]),_:1},8,["color"])]),_:1}),a(t(g),{label:"请求路径"},{default:o(()=>[l(n(s.value.path),1)]),_:1}),a(t(g),{label:"响应码"},{default:o(()=>[a(t(k),{color:z(s.value.response_code)},{default:o(()=>[l(n(s.value.response_code),1)]),_:1},8,["color"])]),_:1}),a(t(g),{label:"执行时间"},{default:o(()=>[f("span",{class:V(H(s.value.execute_time))},n(s.value.execute_time)+"ms ",3)]),_:1}),a(t(g),{label:"客户端IP"},{default:o(()=>[l(n(s.value.ip),1)]),_:1}),a(t(g),{label:"状态"},{default:o(()=>[a(t(k),{color:s.value.status===1?"green":"red"},{default:o(()=>[l(n(s.value.status===1?"成功":"失败"),1)]),_:1},8,["color"])]),_:1}),a(t(g),{label:"操作时间",span:2},{default:o(()=>[l(n(U(s.value.created_at)),1)]),_:1})]),_:1}),f("div",se,[e[37]||(e[37]=f("h4",{class:"font-semibold mb-2"},"User Agent",-1)),f("div",ue,n(s.value.user_agent),1)]),s.value.request_body?(_(),x("div",ie,[e[38]||(e[38]=f("h4",{class:"font-semibold mb-2"},"请求内容",-1)),f("pre",de,n(A(s.value.request_body)),1)])):D("",!0),s.value.response_body?(_(),x("div",ne,[e[39]||(e[39]=f("h4",{class:"font-semibold mb-2"},"响应内容",-1)),f("pre",me,n(A(s.value.response_body)),1)])):D("",!0),s.value.error_message?(_(),x("div",pe,[e[40]||(e[40]=f("h4",{class:"font-semibold mb-2 text-red-600"},"错误信息",-1)),f("div",ve,n(s.value.error_message),1)])):D("",!0)])):D("",!0)]),_:1},8,["open"])]),_:1}))}}),vt=h(fe,[["__scopeId","data-v-f511bd40"]]);export{vt as default};
