var M=(P,D,v)=>new Promise((d,c)=>{var p=a=>{try{T(v.next(a))}catch(b){c(b)}},m=a=>{try{T(v.throw(a))}catch(b){c(b)}},T=a=>a.done?d(a.value):Promise.resolve(a.value).then(p,m);T((v=v.apply(P,D)).next())});import{X as O,cf as z,bN as _,bu as G}from"./bootstrap-8TZEei42.js";import{a4 as J,P as g,a9 as K,ax as Z,aa as F,ab as x,ac as r,x as o,a7 as l,aB as s,av as w,aq as A,aV as k,aj as n,ai as f,F as ee,aC as te,b1 as N}from"../jse/index-index-Bfp9fVLj.js";import{C as I}from"./index-sAHdq1L4.js";import se from"./index-CFcASXFh.js";import{D as ae,a as C}from"./index-DG3zxYow.js";import{T as S}from"./index-BfQKXdoT.js";import{A as le}from"./arrow-right-left-BDgZdTz2.js";import{C as re}from"./circle-alert-CYnRIiXj.js";import{_ as oe}from"./page.vue_vue_type_script_setup_true_lang-BY0axxjX.js";import{R as ne}from"./rotate-cw-CKxy7Mi1.js";import{C as ie}from"./circle-check-big-UHBO2soe.js";import{S as ue}from"./settings-BbHHUqin.js";import"./index-d0SnXsRb.js";import"./shallowequal-NoPM3EZB.js";import"./Trigger-DOqqEP9A.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-bo4x4DTi.js";import"./index-D27JxLQ4.js";import"./index-B4u-ZZTz.js";import"./colors-BPXzNSR4.js";import"./collapseMotion-B5MEdO-q.js";import"./slide-CIRZRFAB.js";import"./useRefs-qMOa5Z2N.js";import"./hasIn-DZ2VGsD9.js";import"./isMobile-8sZ0LT6r.js";import"./useMergedState-D4hu3SXC.js";import"./isPlainObject-C6CdBuZO.js";import"./useFlexGapSupport-D2tEWaK3.js";import"./responsiveObserve-DvNweebH.js";const de={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ce={class:"text-center p-4 border rounded-lg"},me={key:0,class:"text-xs text-gray-400 mt-1"},fe={class:"text-center p-4 border rounded-lg"},ve={class:"text-center p-4 border rounded-lg"},pe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ge={class:"text-center p-4 bg-gray-50 rounded-lg"},xe={class:"text-2xl font-bold text-gray-600 mb-1"},be={class:"text-center p-4 bg-blue-50 rounded-lg"},he={class:"text-2xl font-bold text-blue-600 mb-1"},ye={key:0,class:"space-y-4"},_e={class:"font-medium"},we={key:0,class:"mt-6"},ke={class:"flex items-center space-x-2 overflow-x-auto"},Ce={class:"text-xs text-gray-500"},Se={key:1,class:"text-center text-gray-500 py-8"},De={class:"mb-4"},Te=J({__name:"health",setup(P){const D=g(!1),v=g(!1),d=g(0),c=g(!1),p=g(null),m=g([]),T=g(null),a=g({status:"unknown",database:"unknown",redis:"unknown",timestamp:""}),b=()=>M(null,null,function*(){var e,i,y,W,Y,j;D.value=!0;const t=Date.now();try{const u=yield z.getHealthStatus();d.value=Date.now()-t,T.value=u;const R=new Date(u.timestamp*1e3).toISOString();a.value={status:u.status||"unknown",database:((i=(e=u.services)==null?void 0:e.database)==null?void 0:i.status)||"unknown",redis:((W=(y=u.services)==null?void 0:y.redis)==null?void 0:W.status)||"unknown",timestamp:R},m.value.push({status:u.status||"unknown",timestamp:R}),m.value.length>50&&(m.value=m.value.slice(-50)),_.success("健康检查完成")}catch(u){d.value=Date.now()-t;const R=((j=(Y=u==null?void 0:u.response)==null?void 0:Y.data)==null?void 0:j.message)||(u==null?void 0:u.message)||"健康检查失败";_.error(R),a.value={status:"error",database:"error",redis:"error",timestamp:new Date().toISOString()},console.error("Health check failed:",u)}finally{D.value=!1}}),q=()=>M(null,null,function*(){var t,e;v.value=!0;try{const i=yield z.getSimpleHealth();_.success(i.message||"服务正常运行")}catch(i){const y=((e=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:e.message)||(i==null?void 0:i.message)||"服务异常";_.error(y),console.error("Simple health check failed:",i)}finally{v.value=!1}}),E=()=>{c.value=!c.value,c.value?(p.value=setInterval(()=>{b()},3e4),_.info("已开启自动刷新（30秒间隔）")):(p.value&&(clearInterval(p.value),p.value=null),_.info("已关闭自动刷新"))},U=t=>N(t).format("YYYY-MM-DD HH:mm:ss"),Q=t=>N(t).format("HH:mm"),X=t=>N().diff(N(t),"second"),H=t=>{switch(t){case"healthy":case"connected":case"UP":return"text-green-600";case"error":case"disconnected":case"DOWN":return"text-red-600";case"warning":return"text-yellow-600";default:return"text-gray-600"}},B=t=>{switch(t){case"healthy":case"connected":case"UP":return"green";case"error":case"disconnected":case"DOWN":return"red";case"warning":return"orange";default:return"default"}},V=t=>t<100?"text-green-600 font-medium":t<300?"text-yellow-600 font-medium":t<1e3?"text-orange-600 font-medium":"text-red-600 font-medium",$=t=>t<100?"green":t<300?"blue":t<1e3?"orange":"red",L=t=>t<100?"优秀":t<300?"良好":t<1e3?"一般":"较慢",h=(t,e)=>{if(e==="system")switch(t){case"healthy":case"UP":return"正常";case"error":case"DOWN":return"异常";case"warning":return"警告";default:return"未知"}else switch(t){case"connected":case"UP":return"已连接";case"error":case"DOWN":return"连接失败";case"disconnected":return"已断开";default:return"未知"}};return K(()=>{b()}),Z(()=>{p.value&&clearInterval(p.value)}),(t,e)=>(x(),F(l(oe),{description:"实时监控系统健康状态，包括数据库连接、缓存状态等关键指标",title:"系统健康监控"},{default:r(()=>[o(l(I),{class:"mb-4",title:"系统状态"},{default:r(()=>[s("div",de,[s("div",ce,[s("div",{class:k(["text-2xl font-bold mb-2",H(a.value.status)])},n(h(a.value.status,"system")),3),e[0]||(e[0]=s("div",{class:"text-sm text-gray-500"},"系统状态",-1)),a.value.timestamp?(x(),w("div",me,n(U(a.value.timestamp)),1)):A("",!0)]),s("div",fe,[s("div",{class:k(["text-2xl font-bold mb-2",H(a.value.database)])},n(h(a.value.database,"database")),3),e[1]||(e[1]=s("div",{class:"text-sm text-gray-500"},"数据库",-1)),e[2]||(e[2]=s("div",{class:"text-xs text-gray-400 mt-1"},"MySQL",-1))]),s("div",ve,[s("div",{class:k(["text-2xl font-bold mb-2",H(a.value.redis)])},n(h(a.value.redis,"redis")),3),e[3]||(e[3]=s("div",{class:"text-sm text-gray-500"},"缓存",-1)),e[4]||(e[4]=s("div",{class:"text-xs text-gray-400 mt-1"},"Redis",-1))])])]),_:1}),o(l(I),{class:"mb-4",title:"性能指标"},{default:r(()=>[s("div",pe,[s("div",ge,[s("div",xe,n(d.value)+"ms",1),e[5]||(e[5]=s("div",{class:"text-sm text-gray-500"},"响应时间",-1)),s("div",{class:k(["text-xs",V(d.value)])},n(L(d.value)),3)]),s("div",be,[s("div",he,n(m.value.length),1),e[6]||(e[6]=s("div",{class:"text-sm text-gray-500"},"检查次数",-1)),e[7]||(e[7]=s("div",{class:"text-xs text-gray-400"},"本次会话",-1))])])]),_:1}),o(l(I),{class:"mb-4",title:"操作"},{default:r(()=>[o(l(se),null,{default:r(()=>[o(l(O),{type:"primary",loading:D.value,onClick:b},{icon:r(()=>[o(l(ne),{class:"w-4 h-4"})]),default:r(()=>[e[8]||(e[8]=f(" 刷新状态 "))]),_:1},8,["loading"]),o(l(O),{onClick:q,loading:v.value},{icon:r(()=>[o(l(ie),{class:"w-4 h-4"})]),default:r(()=>[e[9]||(e[9]=f(" 简单检查 "))]),_:1},8,["loading"]),o(l(O),{onClick:E,type:c.value?"default":"dashed"},{icon:r(()=>[o(l(ue),{class:"w-4 h-4"})]),default:r(()=>[f(" "+n(c.value?"停止自动刷新":"开启自动刷新"),1)]),_:1},8,["type"])]),_:1})]),_:1}),o(l(I),{title:"详细信息"},{default:r(()=>[a.value.timestamp?(x(),w("div",ye,[o(l(ae),{column:2,bordered:"",size:"small"},{default:r(()=>[o(l(C),{label:"最后更新时间"},{default:r(()=>[s("span",_e,n(U(a.value.timestamp)),1),X(a.value.timestamp)<60?(x(),F(l(S),{key:0,color:"blue",class:"ml-2"},{default:r(()=>[o(l(le),{class:"w-3 h-3 mr-1"}),e[10]||(e[10]=f(" 实时 "))]),_:1})):A("",!0)]),_:1}),o(l(C),{label:"响应时间"},{default:r(()=>[s("span",{class:k(V(d.value))},n(d.value)+"ms",3),o(l(S),{color:$(d.value),class:"ml-2"},{default:r(()=>[f(n(L(d.value)),1)]),_:1},8,["color"])]),_:1}),o(l(C),{label:"系统状态"},{default:r(()=>[o(l(S),{color:B(a.value.status)},{default:r(()=>[f(n(h(a.value.status,"system")),1)]),_:1},8,["color"])]),_:1}),o(l(C),{label:"数据库状态"},{default:r(()=>[o(l(S),{color:B(a.value.database)},{default:r(()=>[f(n(h(a.value.database,"database")),1)]),_:1},8,["color"])]),_:1}),o(l(C),{label:"缓存状态"},{default:r(()=>[o(l(S),{color:B(a.value.redis)},{default:r(()=>[f(n(h(a.value.redis,"redis")),1)]),_:1},8,["color"])]),_:1}),o(l(C),{label:"自动刷新"},{default:r(()=>[o(l(S),{color:c.value?"blue":"default"},{default:r(()=>[f(n(c.value?"已开启（30秒）":"已关闭"),1)]),_:1},8,["color"])]),_:1})]),_:1}),m.value.length>0?(x(),w("div",we,[e[11]||(e[11]=s("h4",{class:"text-lg font-medium mb-3"},"健康状态趋势",-1)),s("div",ke,[(x(!0),w(ee,null,te(m.value.slice(-20),(i,y)=>(x(),w("div",{key:y,class:"flex-shrink-0 text-center"},[s("div",{class:k(["w-3 h-3 rounded-full mb-1",H(i.status).replace("text-","bg-")])},null,2),s("div",Ce,n(Q(i.timestamp)),1)]))),128))])])):A("",!0)])):(x(),w("div",Se,[s("div",De,[o(l(re),{class:"w-16 h-16 mx-auto text-gray-400"})]),e[12]||(e[12]=s("p",{class:"text-lg mb-2"},"暂无健康检查数据",-1)),e[13]||(e[13]=s("p",{class:"text-sm"},'点击"刷新状态"获取详细信息',-1))]))]),_:1})]),_:1}))}}),rt=G(Te,[["__scopeId","data-v-9c6efb23"]]);export{rt as default};
