var h=(D,y,c)=>new Promise((p,s)=>{var b=n=>{try{a(c.next(n))}catch(k){s(k)}},x=n=>{try{a(c.throw(n))}catch(k){s(k)}},a=n=>n.done?p(n.value):Promise.resolve(n.value).then(b,x);a((c=c.apply(D,y)).next())});import{a4 as O,P as f,T as Y,a9 as E,aa as C,ab as _,ac as r,x as i,a7 as t,av as P,aq as B,aj as R,ai as v,aB as L,b1 as A}from"../jse/index-index-Bfp9fVLj.js";import{X as T,bL as X,ce as g,bN as u,bu as G}from"./bootstrap-8TZEei42.js";import{C as J}from"./index-sAHdq1L4.js";import{T as K}from"./index-BfQKXdoT.js";import"./index-Brf31eMN.js";import{F as Q,a as d}from"./index-BJdPPNAb.js";import{Textarea as W}from"./index-CNxovIFI.js";import{I as q}from"./Password-BTLJaSmc.js";import Z,{SelectOption as N}from"./index-CjPh78nq.js";import{_ as ee}from"./page.vue_vue_type_script_setup_true_lang-BY0axxjX.js";import{T as te}from"./index-Q22sitgt.js";import U from"./index-BbMMZWu9.js";import{P as ae}from"./index-SftpmQNt.js";import"./index-d0SnXsRb.js";import"./shallowequal-NoPM3EZB.js";import"./Trigger-DOqqEP9A.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-bo4x4DTi.js";import"./index-D27JxLQ4.js";import"./index-B4u-ZZTz.js";import"./colors-BPXzNSR4.js";import"./collapseMotion-B5MEdO-q.js";import"./slide-CIRZRFAB.js";import"./useRefs-qMOa5Z2N.js";import"./hasIn-DZ2VGsD9.js";import"./isMobile-8sZ0LT6r.js";import"./useMergedState-D4hu3SXC.js";import"./isPlainObject-C6CdBuZO.js";import"./responsiveObserve-DvNweebH.js";import"./useFlexGapSupport-D2tEWaK3.js";import"./debounce-XLPEvZnf.js";import"./FormItemContext-rLUZDVS8.js";import"./index-hbqzz9bt.js";import"./SearchOutlined-DwCm3gjA.js";import"./statusUtils-Du58bhOV.js";import"./BaseInput-BGap_2jZ.js";import"./EyeOutlined-Dd3Pi4Q1.js";import"./index-_voPasPS.js";import"./DownOutlined-9dNQhNuA.js";import"./CheckOutlined-BM_eCpQE.js";import"./move-DwobPZCz.js";import"./index-Citz1j1Z.js";import"./index-MTZpYbOL.js";import"./index-B-LRQwvO.js";import"./index-BSNvJqe7.js";import"./Checkbox-BxPImIEi.js";import"./index-CuO3k1mL.js";const ie=["href"],oe={key:3,class:"flex space-x-2"},le=O({__name:"domain",setup(D){const y=f(!1),c=f([]),p=f(!1),s=f(!1),b=f(null),x=f(),a=Y({domain:"",protocol:"https",site_name:"",icp_number:"",police_number:"",pass_query_params:!1,description:"",is_active:!0}),n={domain:[{required:!0,message:"请输入域名",trigger:"blur"},{type:"string",required:!0,message:"请输入有效的域名，如：short.ly 或 dwz.example.com",trigger:"blur"}],protocol:[{required:!0,message:"请选择协议",trigger:"change"}]},k=[{title:"域名",key:"domain",dataIndex:"domain",width:200},{title:"协议",dataIndex:"protocol",width:80},{title:"网站名称",dataIndex:"site_name",width:150,ellipsis:!0},{title:"状态",key:"is_active",width:80},{title:"查询参数",key:"pass_query_params",width:100},{title:"描述",dataIndex:"description",width:150,ellipsis:!0},{title:"创建时间",dataIndex:"created_at",width:150,customRender:({text:l})=>M(l)},{title:"操作",key:"actions",width:120,fixed:"right"}],w=()=>h(null,null,function*(){y.value=!0;try{const l=yield g.getList();c.value=l.list}catch(l){u.error("加载数据失败")}finally{y.value=!1}}),V=()=>{s.value=!1,S(),p.value=!0},$=l=>{s.value=!0,b.value=l,Object.assign(a,{domain:l.domain,protocol:l.protocol,site_name:l.site_name,icp_number:l.icp_number,police_number:l.police_number,pass_query_params:l.pass_query_params,description:l.description,is_active:l.is_active}),p.value=!0},j=()=>h(null,null,function*(){try{yield x.value.validate(),s.value&&b.value?(yield g.update(b.value.id,a),u.success("更新成功")):(yield g.create(a),u.success("创建成功")),p.value=!1,w()}catch(l){u.error(s.value?"更新失败":"创建失败")}}),z=()=>{p.value=!1,S()},F=l=>h(null,null,function*(){try{yield g.remove(l.id),u.success("删除成功"),w()}catch(e){u.error("删除失败")}}),H=(l,e)=>h(null,null,function*(){try{yield g.update(l.id,{is_active:e}),u.success("状态更新成功"),w()}catch(o){u.error("状态更新失败")}}),S=()=>{Object.assign(a,{domain:"",protocol:"https",site_name:"",icp_number:"",police_number:"",pass_query_params:!1,description:"",is_active:!0})},M=l=>A(l).format("YYYY-MM-DD HH:mm:ss");return E(()=>{w()}),(l,e)=>(_(),C(t(ee),{description:"管理短网址使用的域名配置，支持多协议和备案信息设置",title:"域名管理"},{default:r(()=>[i(t(J),{title:"域名列表"},{extra:r(()=>[i(t(T),{type:"primary",onClick:V},{default:r(()=>e[9]||(e[9]=[v("添加域名")])),_:1})]),default:r(()=>[i(t(te),{columns:k,"data-source":c.value,loading:y.value,"row-key":"id",pagination:!1},{bodyCell:r(({column:o,record:m})=>[o.key==="domain"?(_(),P("a",{key:0,href:`${m.protocol}://${m.domain}`,target:"_blank",class:"text-blue-600 hover:text-blue-800"},R(m.domain),9,ie)):o.key==="is_active"?(_(),C(t(U),{key:1,checked:m.is_active,onChange:I=>H(m,!!I)},null,8,["checked","onChange"])):o.key==="pass_query_params"?(_(),C(t(K),{key:2,color:m.pass_query_params?"green":"red"},{default:r(()=>[v(R(m.pass_query_params?"透传":"不透传"),1)]),_:2},1032,["color"])):o.key==="actions"?(_(),P("div",oe,[i(t(T),{size:"small",type:"link",onClick:I=>$(m)},{default:r(()=>e[10]||(e[10]=[v(" 编辑 ")])),_:2},1032,["onClick"]),i(t(ae),{title:"确定要删除这个域名配置吗？",onConfirm:I=>F(m)},{default:r(()=>[i(t(T),{size:"small",type:"link",danger:""},{default:r(()=>e[11]||(e[11]=[v("删除")])),_:1})]),_:2},1032,["onConfirm"])])):B("",!0)]),_:1},8,["data-source","loading"])]),_:1}),i(t(X),{open:p.value,"onUpdate:open":e[8]||(e[8]=o=>p.value=o),title:s.value?"编辑域名":"添加域名",width:"500px",onOk:j,onCancel:z},{default:r(()=>[i(t(Q),{ref_key:"formRef",ref:x,model:a,rules:n,layout:"vertical"},{default:r(()=>[i(t(d),{label:"域名",name:"domain"},{default:r(()=>[i(t(q),{value:a.domain,"onUpdate:value":e[0]||(e[0]=o=>a.domain=o),placeholder:"请输入域名，如：short.ly 或 dwz.example.com",disabled:s.value},null,8,["value","disabled"])]),_:1}),i(t(d),{label:"协议",name:"protocol"},{default:r(()=>[i(t(Z),{value:a.protocol,"onUpdate:value":e[1]||(e[1]=o=>a.protocol=o)},{default:r(()=>[i(t(N),{value:"https"},{default:r(()=>e[12]||(e[12]=[v("HTTPS")])),_:1}),i(t(N),{value:"http"},{default:r(()=>e[13]||(e[13]=[v("HTTP")])),_:1})]),_:1},8,["value"])]),_:1}),i(t(d),{label:"网站名称",name:"site_name"},{default:r(()=>[i(t(q),{value:a.site_name,"onUpdate:value":e[2]||(e[2]=o=>a.site_name=o),placeholder:"可选，网站名称"},null,8,["value"])]),_:1}),i(t(d),{label:"ICP备案号",name:"icp_number"},{default:r(()=>[i(t(q),{value:a.icp_number,"onUpdate:value":e[3]||(e[3]=o=>a.icp_number=o),placeholder:"可选，ICP备案号"},null,8,["value"])]),_:1}),i(t(d),{label:"公安备案号",name:"police_number"},{default:r(()=>[i(t(q),{value:a.police_number,"onUpdate:value":e[4]||(e[4]=o=>a.police_number=o),placeholder:"可选，公安备案号"},null,8,["value"])]),_:1}),i(t(d),{label:"透传查询参数",name:"pass_query_params"},{default:r(()=>[i(t(U),{checked:a.pass_query_params,"onUpdate:checked":e[5]||(e[5]=o=>a.pass_query_params=o),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"]),e[14]||(e[14]=L("div",{class:"mt-2 text-sm text-gray-500"}," 启用后，跳转时会将短网址的查询参数透传给原始URL ",-1))]),_:1}),i(t(d),{label:"描述",name:"description"},{default:r(()=>[i(t(W),{value:a.description,"onUpdate:value":e[6]||(e[6]=o=>a.description=o),placeholder:"可选，域名用途描述",rows:3},null,8,["value"])]),_:1}),s.value?(_(),C(t(d),{key:0,label:"状态",name:"is_active"},{default:r(()=>[i(t(U),{checked:a.is_active,"onUpdate:checked":e[7]||(e[7]=o=>a.is_active=o),"checked-children":"启用","un-checked-children":"禁用"},null,8,["checked"])]),_:1})):B("",!0)]),_:1},8,["model"])]),_:1},8,["open","title"])]),_:1}))}}),tt=G(le,[["__scopeId","data-v-874511e1"]]);export{tt as default};
