var h=(M,x,c)=>new Promise((S,k)=>{var b=r=>{try{f(c.next(r))}catch(l){k(l)}},T=r=>{try{f(c.throw(r))}catch(l){k(l)}},f=r=>r.done?S(r.value):Promise.resolve(r.value).then(b,T);f((c=c.apply(M,x)).next())});import{X as _,bL as j,ci as z,bN as v,bu as ae}from"./bootstrap-8TZEei42.js";import{a4 as oe,P as y,T as D,a9 as se,aa as I,ab as d,ac as s,x as o,a7 as a,aB as i,ai as u,av as g,aq as N,aj as C,F as O,b1 as F}from"../jse/index-index-Bfp9fVLj.js";import{C as R}from"./index-sAHdq1L4.js";import"./index-CNxovIFI.js";import{I as $}from"./Password-BTLJaSmc.js";import ne,{SelectOption as A}from"./index-CjPh78nq.js";import{P as re}from"./plus-BCwFLZe-.js";import{T as le}from"./index-BfQKXdoT.js";import"./index-Brf31eMN.js";import{F as ie,a as Y}from"./index-BJdPPNAb.js";import{D as de}from"./dayjs-B7d_3Ic4.js";import{C as me}from"./circle-check-big-UHBO2soe.js";import{_ as pe}from"./page.vue_vue_type_script_setup_true_lang-BY0axxjX.js";import{S as ue}from"./search-Acm0BD4o.js";import{T as ce}from"./index-Q22sitgt.js";import{C as q}from"./copy-BzImV03D.js";import{P as ke}from"./index-SftpmQNt.js";import"./index-d0SnXsRb.js";import"./shallowequal-NoPM3EZB.js";import"./Trigger-DOqqEP9A.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-bo4x4DTi.js";import"./index-D27JxLQ4.js";import"./index-B4u-ZZTz.js";import"./colors-BPXzNSR4.js";import"./collapseMotion-B5MEdO-q.js";import"./slide-CIRZRFAB.js";import"./useRefs-qMOa5Z2N.js";import"./hasIn-DZ2VGsD9.js";import"./isMobile-8sZ0LT6r.js";import"./useMergedState-D4hu3SXC.js";import"./isPlainObject-C6CdBuZO.js";import"./FormItemContext-rLUZDVS8.js";import"./index-hbqzz9bt.js";import"./SearchOutlined-DwCm3gjA.js";import"./statusUtils-Du58bhOV.js";import"./BaseInput-BGap_2jZ.js";import"./EyeOutlined-Dd3Pi4Q1.js";import"./index-_voPasPS.js";import"./DownOutlined-9dNQhNuA.js";import"./CheckOutlined-BM_eCpQE.js";import"./move-DwobPZCz.js";import"./responsiveObserve-DvNweebH.js";import"./useFlexGapSupport-D2tEWaK3.js";import"./debounce-XLPEvZnf.js";import"./index-C4ppseFx.js";import"./index-Citz1j1Z.js";import"./index-MTZpYbOL.js";import"./index-B-LRQwvO.js";import"./index-BSNvJqe7.js";import"./Checkbox-BxPImIEi.js";import"./index-CuO3k1mL.js";const fe={class:"flex items-center justify-between"},_e={class:"flex items-center space-x-4"},ve={key:0,class:"flex items-center space-x-2"},ye={class:"text-xs bg-gray-100 px-2 py-1 rounded"},ge={key:0},xe={key:1,class:"text-gray-500"},be={key:0},Te={key:1,class:"text-gray-500"},we={class:"text-center"},he={class:"mb-4"},Ce={class:"mb-4"},Se={class:"p-3 bg-gray-50 rounded border"},Ie={class:"flex items-center justify-between"},Pe={class:"text-sm flex-1 mr-2 break-all font-mono"},ze={class:"flex justify-center"},De=oe({__name:"tokens",setup(M){const x=y(!1),c=y(!1),S=y([]),k=y(!1),b=y(!1),T=y(""),f=y(),r=D({token_name:"",status:void 0}),l=D({token_name:"",expire_at:void 0}),m=D({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`共 ${t} 条记录`}),L={token_name:[{required:!0,message:"请输入Token名称",trigger:"blur"},{max:100,message:"Token名称不能超过100字符",trigger:"blur"}]},E=[{title:"ID",dataIndex:"id",width:80},{title:"Token名称",dataIndex:"token_name",width:200},{title:"Token",key:"token",width:300},{title:"状态",key:"status",width:100},{title:"过期时间",key:"expire_at",width:180},{title:"最后使用",key:"last_used_at",width:180},{title:"创建时间",dataIndex:"created_at",width:180,customRender:({text:t})=>P(t)},{title:"操作",key:"actions",width:100,fixed:"right"}],w=()=>h(null,null,function*(){x.value=!0;try{const t={page:m.current,page_size:m.pageSize,token_name:r.token_name||void 0,status:r.status},e=yield z.getList(t);S.value=e.list,m.total=e.total,m.current=e.page,m.pageSize=e.size}catch(t){console.error("加载Token列表失败:",t),v.error((t==null?void 0:t.message)||"加载数据失败")}finally{x.value=!1}}),B=()=>{m.current=1,w()},H=()=>{r.token_name="",r.status=void 0,m.current=1,w()},J=()=>{V(),k.value=!0},Q=()=>h(null,null,function*(){try{yield f.value.validate(),c.value=!0;const t={token_name:l.token_name,expire_at:l.expire_at?F(l.expire_at).toISOString():void 0},e=yield z.create(t);v.success("Token创建成功"),T.value=e.token||"",k.value=!1,b.value=!0,w()}catch(t){console.error("创建Token失败:",t),v.error((t==null?void 0:t.message)||"Token创建失败")}finally{c.value=!1}}),X=()=>{k.value=!1,V()},G=t=>h(null,null,function*(){try{yield z.remove(t.id),v.success("Token删除成功"),w()}catch(e){console.error("删除Token失败:",e),v.error((e==null?void 0:e.message)||"删除失败")}}),K=t=>{m.current=t.current,m.pageSize=t.pageSize,w()},U=t=>h(null,null,function*(){try{yield navigator.clipboard.writeText(t),v.success("复制成功")}catch(e){console.error("复制失败:",e),v.error("复制失败，请手动复制")}}),W=()=>{b.value=!1,T.value=""},V=()=>{var t;l.token_name="",l.expire_at=void 0,(t=f.value)==null||t.resetFields()},Z=t=>t&&t<F().endOf("day"),ee=t=>t?t.length<=12?t:t.substring(0,8)+"..."+t.substring(t.length-4):"***",P=t=>F(t).format("YYYY-MM-DD HH:mm:ss");return se(()=>{w()}),(t,e)=>(d(),I(a(pe),{description:"管理API Token，包括创建、查看和删除Token等功能",title:"API Token管理"},{default:s(()=>[o(a(R),{title:"搜索筛选",class:"mb-4"},{default:s(()=>[i("div",fe,[i("div",_e,[o(a($),{value:r.token_name,"onUpdate:value":e[0]||(e[0]=n=>r.token_name=n),placeholder:"请输入Token名称",style:{width:"200px"},onPressEnter:B},{prefix:s(()=>[o(a(ue),{class:"h-4 w-4"})]),_:1},8,["value"]),o(a(ne),{value:r.status,"onUpdate:value":e[1]||(e[1]=n=>r.status=n),placeholder:"选择状态",style:{width:"120px"},"allow-clear":""},{default:s(()=>[o(a(A),{value:1},{default:s(()=>e[7]||(e[7]=[u("启用")])),_:1}),o(a(A),{value:0},{default:s(()=>e[8]||(e[8]=[u("禁用")])),_:1})]),_:1},8,["value"]),o(a(_),{type:"primary",onClick:B,loading:x.value},{default:s(()=>e[9]||(e[9]=[u(" 搜索 ")])),_:1},8,["loading"]),o(a(_),{onClick:H},{default:s(()=>e[10]||(e[10]=[u(" 重置 ")])),_:1})]),o(a(_),{type:"primary",onClick:J},{default:s(()=>[o(a(re),{class:"h-4 w-4 mr-1"}),e[11]||(e[11]=u(" 创建Token "))]),_:1})])]),_:1}),o(a(R),{title:"Token列表"},{default:s(()=>[o(a(ce),{columns:E,"data-source":S.value,loading:x.value,pagination:m,"row-key":"id",onChange:K},{bodyCell:s(({column:n,record:p})=>[n.key==="token"?(d(),g("div",ve,[i("code",ye,C(ee(p.token)),1),p.token?(d(),I(a(_),{key:0,size:"small",type:"link",onClick:te=>U(p.token)},{default:s(()=>[o(a(q),{class:"h-4 w-4"})]),_:2},1032,["onClick"])):N("",!0)])):n.key==="status"?(d(),I(a(le),{key:1,color:p.status===1?"green":"red"},{default:s(()=>[u(C(p.status===1?"启用":"禁用"),1)]),_:2},1032,["color"])):n.key==="expire_at"?(d(),g(O,{key:2},[p.expire_at?(d(),g("span",ge,C(P(p.expire_at)),1)):(d(),g("span",xe,"永不过期"))],64)):n.key==="last_used_at"?(d(),g(O,{key:3},[p.last_used_at?(d(),g("span",be,C(P(p.last_used_at)),1)):(d(),g("span",Te,"从未使用"))],64)):n.key==="actions"?(d(),I(a(ke),{key:4,title:"确定要删除这个Token吗？","ok-text":"确定","cancel-text":"取消",onConfirm:te=>G(p)},{default:s(()=>[o(a(_),{size:"small",type:"link",danger:""},{default:s(()=>e[12]||(e[12]=[u(" 删除 ")])),_:1})]),_:2},1032,["onConfirm"])):N("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),o(a(j),{open:k.value,"onUpdate:open":e[4]||(e[4]=n=>k.value=n),title:"创建API Token",width:"500px",onOk:Q,onCancel:X,"confirm-loading":c.value},{default:s(()=>[o(a(ie),{ref_key:"createFormRef",ref:f,model:l,rules:L,layout:"vertical"},{default:s(()=>[o(a(Y),{label:"Token名称",name:"token_name"},{default:s(()=>[o(a($),{value:l.token_name,"onUpdate:value":e[2]||(e[2]=n=>l.token_name=n),placeholder:"请输入Token名称",maxlength:100},null,8,["value"])]),_:1}),o(a(Y),{label:"过期时间",name:"expire_at"},{default:s(()=>[o(a(de),{value:l.expire_at,"onUpdate:value":e[3]||(e[3]=n=>l.expire_at=n),"show-time":"",placeholder:"选择过期时间，留空则永不过期",style:{width:"100%"},"disabled-date":Z},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","confirm-loading"]),o(a(j),{open:b.value,"onUpdate:open":e[6]||(e[6]=n=>b.value=n),title:"Token创建成功",width:"600px",footer:null,"mask-closable":!1,closable:!1},{default:s(()=>[i("div",we,[i("div",he,[o(a(me),{class:"text-4xl text-green-500 mx-auto"})]),e[15]||(e[15]=i("h3",{class:"text-lg font-semibold mb-4"},"Token创建成功！",-1)),e[16]||(e[16]=i("div",{class:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded"},[i("p",{class:"text-yellow-800 text-sm"},[i("strong",null,"重要提示："),u(" 请立即复制并保存您的Token，离开此页面后将无法再次查看完整Token！ ")])],-1)),i("div",Ce,[i("div",Se,[i("div",Ie,[i("code",Pe,C(T.value),1),o(a(_),{type:"primary",onClick:e[5]||(e[5]=n=>U(T.value))},{default:s(()=>[o(a(q),{class:"h-4 w-4 mr-1"}),e[13]||(e[13]=u(" 复制 "))]),_:1})])])]),i("div",ze,[o(a(_),{type:"primary",onClick:W},{default:s(()=>e[14]||(e[14]=[u(" 我已保存 ")])),_:1})])])]),_:1},8,["open"])]),_:1}))}}),Ft=ae(De,[["__scopeId","data-v-8b6b459b"]]);export{Ft as default};
