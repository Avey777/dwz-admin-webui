var Ct=Object.defineProperty,St=Object.defineProperties;var Ut=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var Q=(m,u,d)=>u in m?Ct(m,u,{enumerable:!0,configurable:!0,writable:!0,value:d}):m[u]=d,K=(m,u)=>{for(var d in u||(u={}))X.call(u,d)&&Q(m,d,u[d]);if(j)for(var d of j(u))G.call(u,d)&&Q(m,d,u[d]);return m},W=(m,u)=>St(m,Ut(u));var Z=(m,u)=>{var d={};for(var _ in m)X.call(m,_)&&u.indexOf(_)<0&&(d[_]=m[_]);if(m!=null&&j)for(var _ of j(m))u.indexOf(_)<0&&G.call(m,_)&&(d[_]=m[_]);return d};var A=(m,u,d)=>new Promise((_,b)=>{var q=c=>{try{T(d.next(c))}catch(V){b(V)}},w=c=>{try{T(d.throw(c))}catch(V){b(V)}},T=c=>c.done?_(c.value):Promise.resolve(c.value).then(q,w);T((d=d.apply(m,u)).next())});import{a4 as It,P as x,J as Rt,T as N,b1 as $,a9 as Bt,aa as C,ab as v,ac as l,x as i,a7 as a,av as S,F as O,aC as P,ai as r,aj as y,aq as z,aB as p}from"../jse/index-index-Bfp9fVLj.js";import{X as U,bL as tt,c0 as L,bN as k,c1 as At,bu as zt}from"./bootstrap-8TZEei42.js";import{C as et}from"./index-sAHdq1L4.js";import Tt from"./index-CFcASXFh.js";import F,{SelectOption as g}from"./index-CjPh78nq.js";import{T as at}from"./index-BfQKXdoT.js";import"./index-Brf31eMN.js";import{F as $t,a as h}from"./index-BJdPPNAb.js";import{Textarea as st}from"./index-CNxovIFI.js";import{I as M}from"./Password-BTLJaSmc.js";import{R as Lt}from"./dayjs-B7d_3Ic4.js";import Vt from"./index-KC_B0vvM.js";import{_ as qt}from"./page.vue_vue_type_script_setup_true_lang-BY0axxjX.js";import{T as Y}from"./index-Q22sitgt.js";import{P as Ft}from"./index-SftpmQNt.js";import jt from"./index-BbMMZWu9.js";import"./index-d0SnXsRb.js";import"./shallowequal-NoPM3EZB.js";import"./Trigger-DOqqEP9A.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-bo4x4DTi.js";import"./index-D27JxLQ4.js";import"./index-B4u-ZZTz.js";import"./colors-BPXzNSR4.js";import"./collapseMotion-B5MEdO-q.js";import"./slide-CIRZRFAB.js";import"./useRefs-qMOa5Z2N.js";import"./hasIn-DZ2VGsD9.js";import"./isMobile-8sZ0LT6r.js";import"./useMergedState-D4hu3SXC.js";import"./isPlainObject-C6CdBuZO.js";import"./useFlexGapSupport-D2tEWaK3.js";import"./index-_voPasPS.js";import"./BaseInput-BGap_2jZ.js";import"./DownOutlined-9dNQhNuA.js";import"./CheckOutlined-BM_eCpQE.js";import"./SearchOutlined-DwCm3gjA.js";import"./move-DwobPZCz.js";import"./FormItemContext-rLUZDVS8.js";import"./statusUtils-Du58bhOV.js";import"./responsiveObserve-DvNweebH.js";import"./debounce-XLPEvZnf.js";import"./index-hbqzz9bt.js";import"./EyeOutlined-Dd3Pi4Q1.js";import"./index-C4ppseFx.js";import"./index-Citz1j1Z.js";import"./index-MTZpYbOL.js";import"./index-B-LRQwvO.js";import"./index-BSNvJqe7.js";import"./Checkbox-BxPImIEi.js";import"./index-CuO3k1mL.js";const Dt={key:2,class:"text-sm"},Nt={key:0},Ot={key:1},Pt={key:3,class:"flex space-x-2"},Mt={class:"space-y-4"},Yt={class:"mb-2 flex items-center justify-between"},Et={class:"font-medium"},Ht={class:"grid grid-cols-2 gap-4"},Jt={key:0},Qt={class:"mb-6"},Xt={class:"grid grid-cols-3 gap-4"},Gt={class:"rounded bg-blue-50 p-4 text-center"},Kt={class:"text-2xl font-bold text-blue-600"},Wt={class:"rounded bg-green-50 p-4 text-center"},Zt={class:"text-2xl font-bold text-green-600"},te={class:"rounded bg-purple-50 p-4 text-center"},ee={class:"text-xl font-bold text-purple-600"},ae={class:"mb-6"},se=It({__name:"ab-test",setup(m){const u=x(!1),d=x([]),_=x([]),b=x(!1),q=x(!1),w=x(!1),T=x(null),c=x(null),V=x(),E=Rt({get:()=>{if(n.start_time&&n.end_time)return[typeof n.start_time=="string"?$(n.start_time):n.start_time,typeof n.end_time=="string"?$(n.end_time):n.end_time]},set:e=>{e&&Array.isArray(e)&&e.length===2?(n.start_time=e[0],n.end_time=e[1]):(n.start_time=void 0,n.end_time=void 0)}}),I=N({short_link_id:void 0,status:void 0}),R=N({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`}),n=N({short_link_id:0,name:"",description:"",traffic_split:"equal",start_time:void 0,end_time:void 0,variants:[{name:"变体A",target_url:"",weight:50,is_control:!0,description:""},{name:"变体B",target_url:"",weight:50,is_control:!1,description:""}],status:"draft"}),lt={short_link_id:[{required:!0,message:"请选择短网址",trigger:"change"}],name:[{required:!0,message:"请输入测试名称",trigger:"blur"}],variants:[{required:!0,message:"至少需要2个变体",trigger:"change"}]},it=[{title:"测试名称",dataIndex:"name",width:200},{title:"短网址",dataIndex:"short_link_id",width:150,customRender:({text:e})=>{const t=_.value.find(s=>s.id===e);return(t==null?void 0:t.short_url)||e}},{title:"状态",key:"status",width:100},{title:"流量分配",key:"traffic_split",width:100},{title:"变体数量",dataIndex:"variants",width:80,customRender:({text:e})=>(e==null?void 0:e.length)||0},{title:"时间范围",key:"time_range",width:200},{title:"创建时间",dataIndex:"created_at",width:150,customRender:({text:e})=>D(e)},{title:"操作",key:"actions",width:200,fixed:"right"}],nt=[{title:"变体名称",dataIndex:["variant","name"],width:150},{title:"目标URL",dataIndex:["variant","target_url"],width:200,ellipsis:!0},{title:"权重",dataIndex:["variant","weight"],width:80,customRender:({text:e})=>`${e}%`},{title:"点击数",dataIndex:"click_count",width:100},{title:"占比",dataIndex:"percentage",width:100,customRender:({text:e})=>`${e.toFixed(1)}%`},{title:"转化率",dataIndex:"conversion_rate",width:100,customRender:({text:e})=>`${e.toFixed(1)}%`},{title:"对照组",dataIndex:["variant","is_control"],width:80,customRender:({text:e})=>e?"是":"否"}],ot=[{title:"日期",dataIndex:"date"},{title:"变体点击数",dataIndex:"variants",customRender:({text:e})=>Object.entries(e).map(([t,s])=>`变体${t}: ${s}`).join(", ")}],B=()=>A(null,null,function*(){u.value=!0;try{const e={page:R.current,page_size:R.pageSize,short_link_id:I.short_link_id,status:I.status},t=yield L.getList(e);d.value=t.list,R.total=t.total}catch(e){k.error("加载数据失败")}finally{u.value=!1}}),rt=()=>A(null,null,function*(){try{const e=yield At.getList({page:1,page_size:100});_.value=e.list}catch(e){k.error("加载短网址失败")}}),H=()=>{R.current=1,B()},dt=()=>{I.short_link_id=void 0,I.status=void 0,R.current=1,B()},ut=e=>{R.current=e.current,R.pageSize=e.pageSize,B()},mt=()=>{w.value=!1,J(),b.value=!0},pt=e=>{w.value=!0,T.value=e,Object.assign(n,{short_link_id:e.short_link_id,name:e.name,description:e.description,traffic_split:e.traffic_split,start_time:e.start_time?$(e.start_time):void 0,end_time:e.end_time?$(e.end_time):void 0,variants:[...e.variants],status:e.status}),b.value=!0},vt=()=>A(null,null,function*(){try{yield V.value.validate();const t=W(K({},n),{start_time:n.start_time?$(n.start_time).toISOString():void 0,end_time:n.end_time?$(n.end_time).toISOString():void 0});if(w.value&&T.value){const e=t,{short_link_id:s,variants:o}=e,f=Z(e,["short_link_id","variants"]);yield L.update(T.value.id,f),k.success("更新成功")}else yield L.create(t),k.success("创建成功");b.value=!1,B()}catch(t){k.error(w.value?"更新失败":"创建失败")}}),ft=()=>{b.value=!1,J()},_t=e=>A(null,null,function*(){try{yield L.remove(e.id),k.success("删除成功"),B()}catch(t){k.error("删除失败")}}),ct=e=>A(null,null,function*(){try{yield L.start(e.id,{}),k.success("启动成功"),B()}catch(t){k.error("启动失败")}}),gt=e=>A(null,null,function*(){try{yield L.stop(e.id,{}),k.success("停止成功"),B()}catch(t){k.error("停止失败")}}),yt=e=>A(null,null,function*(){try{const t=yield L.getStatistics(e.id,30);c.value=t,q.value=!0}catch(t){k.error("获取统计数据失败")}}),kt=()=>{n.variants.push({name:`变体${String.fromCodePoint(65+n.variants.length)}`,target_url:"",weight:0,is_control:!1,description:""})},ht=e=>{n.variants.splice(e,1)},J=()=>{Object.assign(n,{short_link_id:0,name:"",description:"",traffic_split:"equal",start_time:void 0,end_time:void 0,variants:[{name:"变体A",target_url:"",weight:50,is_control:!0,description:""},{name:"变体B",target_url:"",weight:50,is_control:!1,description:""}],status:"draft"})},bt=e=>({draft:"default",running:"green",paused:"orange",completed:"blue"})[e]||"default",wt=e=>({draft:"草稿",running:"运行中",paused:"已暂停",completed:"已完成"})[e]||e,xt=e=>({equal:"均等分配",weighted:"权重分配",custom:"自定义"})[e]||e,D=e=>$(e).format("YYYY-MM-DD HH:mm");return Bt(()=>{B(),rt()}),(e,t)=>(v(),C(a(qt),{description:"创建和管理AB测试，比较不同版本的转化效果",title:"AB测试管理"},{default:l(()=>[i(a(et),{class:"mb-4"},{extra:l(()=>[i(a(U),{type:"primary",onClick:mt},{default:l(()=>t[10]||(t[10]=[r("创建AB测试")])),_:1})]),default:l(()=>[i(a(Tt),{class:"mb-4"},{default:l(()=>[i(a(F),{value:I.short_link_id,"onUpdate:value":t[0]||(t[0]=s=>I.short_link_id=s),placeholder:"选择短网址",style:{width:"300px"},"allow-clear":"",onChange:H},{default:l(()=>[(v(!0),S(O,null,P(_.value,s=>(v(),C(a(g),{key:s.id,value:s.id},{default:l(()=>[r(y(s.short_url)+" - "+y(s.title||s.original_url),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),i(a(F),{value:I.status,"onUpdate:value":t[1]||(t[1]=s=>I.status=s),placeholder:"选择状态",style:{width:"150px"},"allow-clear":"",onChange:H},{default:l(()=>[i(a(g),{value:"draft"},{default:l(()=>t[11]||(t[11]=[r("草稿")])),_:1}),i(a(g),{value:"running"},{default:l(()=>t[12]||(t[12]=[r("运行中")])),_:1}),i(a(g),{value:"paused"},{default:l(()=>t[13]||(t[13]=[r("已暂停")])),_:1}),i(a(g),{value:"completed"},{default:l(()=>t[14]||(t[14]=[r("已完成")])),_:1})]),_:1},8,["value"]),i(a(U),{onClick:dt},{default:l(()=>t[15]||(t[15]=[r("重置")])),_:1})]),_:1})]),_:1}),i(a(et),{title:"AB测试列表"},{default:l(()=>[i(a(Y),{columns:it,"data-source":d.value,loading:u.value,pagination:R,"row-key":"id",onChange:ut},{bodyCell:l(({column:s,record:o})=>[s.key==="status"?(v(),C(a(at),{key:0,color:bt(o.status)},{default:l(()=>[r(y(wt(o.status)),1)]),_:2},1032,["color"])):s.key==="traffic_split"?(v(),C(a(at),{key:1},{default:l(()=>[r(y(xt(o.traffic_split)),1)]),_:2},1024)):s.key==="time_range"?(v(),S("div",Dt,[o.start_time?(v(),S("div",Nt," 开始："+y(D(o.start_time)),1)):z("",!0),o.end_time?(v(),S("div",Ot," 结束："+y(D(o.end_time)),1)):z("",!0)])):s.key==="actions"?(v(),S("div",Pt,[o.status==="draft"?(v(),C(a(U),{key:0,size:"small",type:"link",onClick:f=>ct(o)},{default:l(()=>t[16]||(t[16]=[r(" 启动 ")])),_:2},1032,["onClick"])):z("",!0),o.status==="running"?(v(),C(a(U),{key:1,size:"small",type:"link",onClick:f=>gt(o)},{default:l(()=>t[17]||(t[17]=[r(" 停止 ")])),_:2},1032,["onClick"])):z("",!0),i(a(U),{size:"small",type:"link",onClick:f=>yt(o)},{default:l(()=>t[18]||(t[18]=[r(" 统计 ")])),_:2},1032,["onClick"]),i(a(U),{size:"small",type:"link",onClick:f=>pt(o)},{default:l(()=>t[19]||(t[19]=[r(" 编辑 ")])),_:2},1032,["onClick"]),i(a(Ft),{title:"确定要删除这个AB测试吗？",onConfirm:f=>_t(o)},{default:l(()=>[i(a(U),{size:"small",type:"link",danger:""},{default:l(()=>t[20]||(t[20]=[r("删除")])),_:1})]),_:2},1032,["onConfirm"])])):z("",!0)]),_:1},8,["data-source","loading","pagination"])]),_:1}),i(a(tt),{open:b.value,"onUpdate:open":t[8]||(t[8]=s=>b.value=s),title:w.value?"编辑AB测试":"创建AB测试",width:"800px",onOk:vt,onCancel:ft},{default:l(()=>[i(a($t),{ref_key:"formRef",ref:V,model:n,rules:lt,layout:"vertical"},{default:l(()=>[i(a(h),{label:"短网址",name:"short_link_id"},{default:l(()=>[i(a(F),{value:n.short_link_id,"onUpdate:value":t[2]||(t[2]=s=>n.short_link_id=s),placeholder:"选择短网址",disabled:w.value},{default:l(()=>[(v(!0),S(O,null,P(_.value,s=>(v(),C(a(g),{key:s.id,value:s.id},{default:l(()=>[r(y(s.short_url)+" - "+y(s.title||s.original_url),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","disabled"])]),_:1}),i(a(h),{label:"测试名称",name:"name"},{default:l(()=>[i(a(M),{value:n.name,"onUpdate:value":t[3]||(t[3]=s=>n.name=s),placeholder:"请输入测试名称"},null,8,["value"])]),_:1}),i(a(h),{label:"描述",name:"description"},{default:l(()=>[i(a(st),{value:n.description,"onUpdate:value":t[4]||(t[4]=s=>n.description=s),placeholder:"可选，测试描述",rows:3},null,8,["value"])]),_:1}),i(a(h),{label:"流量分配",name:"traffic_split"},{default:l(()=>[i(a(F),{value:n.traffic_split,"onUpdate:value":t[5]||(t[5]=s=>n.traffic_split=s)},{default:l(()=>[i(a(g),{value:"equal"},{default:l(()=>t[21]||(t[21]=[r("均等分配")])),_:1}),i(a(g),{value:"weighted"},{default:l(()=>t[22]||(t[22]=[r("权重分配")])),_:1}),i(a(g),{value:"custom"},{default:l(()=>t[23]||(t[23]=[r("自定义")])),_:1})]),_:1},8,["value"])]),_:1}),i(a(h),{label:"时间范围"},{default:l(()=>[i(a(Lt),{value:E.value,"onUpdate:value":t[6]||(t[6]=s=>E.value=s),"show-time":"",placeholder:["开始时间","结束时间"],style:{width:"100%"}},null,8,["value"])]),_:1}),i(a(h),{label:"测试变体",name:"variants"},{default:l(()=>[p("div",Mt,[(v(!0),S(O,null,P(n.variants,(s,o)=>(v(),S("div",{key:o,class:"rounded border p-4"},[p("div",Yt,[p("span",Et,"变体 "+y(o+1),1),n.variants.length>2?(v(),C(a(U),{key:0,size:"small",danger:"",onClick:f=>ht(o)},{default:l(()=>t[24]||(t[24]=[r(" 删除 ")])),_:2},1032,["onClick"])):z("",!0)]),p("div",Ht,[i(a(h),{label:"变体名称",name:["variants",o,"name"]},{default:l(()=>[i(a(M),{value:s.name,"onUpdate:value":f=>s.name=f,placeholder:"请输入变体名称"},null,8,["value","onUpdate:value"])]),_:2},1032,["name"]),i(a(h),{label:"目标URL",name:["variants",o,"target_url"]},{default:l(()=>[i(a(M),{value:s.target_url,"onUpdate:value":f=>s.target_url=f,placeholder:"请输入目标URL"},null,8,["value","onUpdate:value"])]),_:2},1032,["name"]),i(a(h),{label:"权重",name:["variants",o,"weight"]},{default:l(()=>[i(a(Vt),{value:s.weight,"onUpdate:value":f=>s.weight=f,min:0,max:100,style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1032,["name"]),i(a(h),{label:"对照组",name:["variants",o,"is_control"]},{default:l(()=>[i(a(jt),{checked:s.is_control,"onUpdate:checked":f=>s.is_control=f},null,8,["checked","onUpdate:checked"])]),_:2},1032,["name"])]),i(a(h),{label:"描述",name:["variants",o,"description"]},{default:l(()=>[i(a(st),{value:s.description,"onUpdate:value":f=>s.description=f,placeholder:"可选，变体描述",rows:2},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])]))),128)),i(a(U),{type:"dashed",onClick:kt,block:""},{default:l(()=>t[25]||(t[25]=[r(" 添加变体 ")])),_:1})])]),_:1}),w.value?(v(),C(a(h),{key:0,label:"状态",name:"status"},{default:l(()=>[i(a(F),{value:n.status,"onUpdate:value":t[7]||(t[7]=s=>n.status=s)},{default:l(()=>[i(a(g),{value:"draft"},{default:l(()=>t[26]||(t[26]=[r("草稿")])),_:1}),i(a(g),{value:"running"},{default:l(()=>t[27]||(t[27]=[r("运行中")])),_:1}),i(a(g),{value:"paused"},{default:l(()=>t[28]||(t[28]=[r("已暂停")])),_:1}),i(a(g),{value:"completed"},{default:l(()=>t[29]||(t[29]=[r("已完成")])),_:1})]),_:1},8,["value"])]),_:1})):z("",!0)]),_:1},8,["model"])]),_:1},8,["open","title"]),i(a(tt),{open:q.value,"onUpdate:open":t[9]||(t[9]=s=>q.value=s),title:"AB测试统计",width:"1000px",footer:null},{default:l(()=>{var s;return[c.value?(v(),S("div",Jt,[p("div",Qt,[t[33]||(t[33]=p("h3",{class:"mb-4 text-lg font-semibold"},"总体统计",-1)),p("div",Xt,[p("div",Gt,[p("div",Kt,y(c.value.total_clicks),1),t[30]||(t[30]=p("div",{class:"text-gray-500"},"总点击数",-1))]),p("div",Wt,[p("div",Zt,y(c.value.conversion_rate)+"% ",1),t[31]||(t[31]=p("div",{class:"text-gray-500"},"转化率",-1))]),p("div",te,[p("div",ee,y(((s=c.value.winning_variant)==null?void 0:s.name)||"N/A"),1),t[32]||(t[32]=p("div",{class:"text-gray-500"},"获胜变体",-1))])])]),p("div",ae,[t[34]||(t[34]=p("h3",{class:"mb-4 text-lg font-semibold"},"变体统计",-1)),i(a(Y),{columns:nt,"data-source":c.value.variant_stats,pagination:!1,size:"small"},null,8,["data-source"])]),p("div",null,[t[35]||(t[35]=p("h3",{class:"mb-4 text-lg font-semibold"},"每日统计",-1)),i(a(Y),{columns:ot,"data-source":c.value.daily_stats,pagination:!1,size:"small"},null,8,["data-source"])])])):z("",!0)]}),_:1},8,["open"])]),_:1}))}}),sa=zt(se,[["__scopeId","data-v-49d0782a"]]);export{sa as default};
