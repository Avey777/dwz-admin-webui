var T=(z,M,_)=>new Promise((j,w)=>{var h=l=>{try{c(_.next(l))}catch(v){w(v)}},f=l=>{try{c(_.throw(l))}catch(v){w(v)}},c=l=>l.done?j(l.value):Promise.resolve(l.value).then(h,f);c((_=_.apply(z,M)).next())});import{a4 as K,P as m,a9 as Q,aa as L,ab as p,ac as n,x as a,aB as t,a7 as o,av as k,F as D,aC as $,ai as y,aj as d,aq as W,b1 as I,n as Y}from"../jse/index-index-Bfp9fVLj.js";import{X as Z,c9 as N,cd as tt,bN as R,c1 as st,bu as et}from"./bootstrap-8TZEei42.js";import{C as b}from"./index-sAHdq1L4.js";import ot from"./index-CFcASXFh.js";import H,{SelectOption as S}from"./index-CjPh78nq.js";import{S as lt}from"./index-B-LRQwvO.js";import{_ as it}from"./page.vue_vue_type_script_setup_true_lang-BY0axxjX.js";import{R as at}from"./dayjs-B7d_3Ic4.js";import{T as U}from"./index-Q22sitgt.js";import"./index-d0SnXsRb.js";import"./shallowequal-NoPM3EZB.js";import"./Trigger-DOqqEP9A.js";import"./ResizeObserver.es-CDE7jhPe.js";import"./_arrayIncludes-B8uzE354.js";import"./Overflow-bo4x4DTi.js";import"./index-D27JxLQ4.js";import"./index-B4u-ZZTz.js";import"./colors-BPXzNSR4.js";import"./collapseMotion-B5MEdO-q.js";import"./slide-CIRZRFAB.js";import"./useRefs-qMOa5Z2N.js";import"./hasIn-DZ2VGsD9.js";import"./isMobile-8sZ0LT6r.js";import"./useMergedState-D4hu3SXC.js";import"./isPlainObject-C6CdBuZO.js";import"./useFlexGapSupport-D2tEWaK3.js";import"./index-_voPasPS.js";import"./BaseInput-BGap_2jZ.js";import"./DownOutlined-9dNQhNuA.js";import"./CheckOutlined-BM_eCpQE.js";import"./SearchOutlined-DwCm3gjA.js";import"./move-DwobPZCz.js";import"./FormItemContext-rLUZDVS8.js";import"./statusUtils-Du58bhOV.js";import"./index-C4ppseFx.js";import"./index-BfQKXdoT.js";import"./index-hbqzz9bt.js";import"./index-Citz1j1Z.js";import"./index-MTZpYbOL.js";import"./responsiveObserve-DvNweebH.js";import"./index-BSNvJqe7.js";import"./Checkbox-BxPImIEi.js";import"./index-CuO3k1mL.js";import"./index-CNxovIFI.js";import"./Password-BTLJaSmc.js";import"./EyeOutlined-Dd3Pi4Q1.js";import"./debounce-XLPEvZnf.js";const nt={class:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4"},rt={class:"rounded-lg border bg-white p-6 shadow-sm"},dt={class:"flex items-center"},ut={class:"ml-4"},ct={class:"text-2xl font-bold text-gray-900"},mt={class:"rounded-lg border bg-white p-6 shadow-sm"},pt={class:"flex items-center"},vt={class:"ml-4"},gt={class:"text-2xl font-bold text-gray-900"},xt={class:"rounded-lg border bg-white p-6 shadow-sm"},ht={class:"flex items-center"},ft={class:"ml-4"},_t={class:"text-2xl font-bold text-gray-900"},kt={class:"rounded-lg border bg-white p-6 shadow-sm"},yt={class:"flex items-center"},bt={class:"ml-4"},wt={class:"text-2xl font-bold text-gray-900"},Ct={key:0,class:"py-8 text-center text-gray-500"},St={key:1,class:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-4"},Mt={class:"rounded-lg border bg-white p-6 shadow-sm"},Bt={class:"flex items-center"},Lt={class:"ml-4"},jt={class:"text-2xl font-bold text-gray-900"},Vt={class:"rounded-lg border bg-white p-6 shadow-sm"},Tt={class:"flex items-center"},zt={class:"ml-4"},Dt={class:"text-2xl font-bold text-gray-900"},$t={class:"rounded-lg border bg-white p-6 shadow-sm"},It={class:"flex items-center"},Nt={class:"ml-4"},Rt={class:"text-2xl font-bold text-gray-900"},Ht={class:"rounded-lg border bg-white p-6 shadow-sm"},Ut={class:"flex items-center"},qt={class:"ml-4"},At={class:"text-2xl font-bold text-gray-900"},Et={class:"mb-6 grid grid-cols-1 gap-6 lg:grid-cols-2"},Ft={class:"h-64"},Ot={key:1,id:"clickTrendChart",class:"h-full w-full"},Pt={class:"space-y-4"},Xt={class:"flex items-center"},Gt={class:"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full bg-blue-100"},Jt={class:"text-sm font-medium text-blue-800"},Kt={class:"ml-3"},Qt={class:"text-sm font-medium text-gray-900"},Wt={class:"max-w-xs truncate text-sm text-gray-500"},Yt={class:"text-right"},Zt={class:"text-sm font-medium text-gray-900"},ts={class:"grid grid-cols-1 gap-6 lg:grid-cols-2"},ss=K({__name:"analytics",setup(z){const M=m(!1),_=m(!1),j=m([]),w=m([]),h=m(),f=m("30"),c=m(),l=m(null),v=m(null),C=m([]),q=[{title:"日期",dataIndex:"date",width:120},{title:"点击数",dataIndex:"click_count",width:100,sorter:(i,s)=>i.click_count-s.click_count}],A=[{title:"短网址",dataIndex:"short_url",width:150,ellipsis:!0},{title:"标题",dataIndex:"title",width:120,ellipsis:!0},{title:"点击数",dataIndex:"click_count",width:80,sorter:(i,s)=>i.click_count-s.click_count},{title:"创建时间",dataIndex:"created_at",width:100,customRender:({text:i})=>I(i).format("MM-DD")}],V=()=>T(null,null,function*(){try{const i=Number(f.value)||30,s=yield tt.getShortLinkStatistics({days:i});C.value=s||[]}catch(i){R.error("加载短链统计失败")}}),B=()=>T(null,null,function*(){if(!h.value){l.value=null;return}M.value=!0;try{let i=Number(f.value);if(c.value){const[e,r]=c.value;i=r.diff(e,"day")+1}const s=yield st.getStatistics(h.value,i);l.value=s,Y(()=>{G()})}catch(i){R.error("获取统计数据失败"),l.value=null}finally{M.value=!1}}),E=()=>{B(),V()},F=()=>{B()},O=()=>{c.value=void 0,B(),V()},P=()=>{c.value&&(f.value="",B(),V())},X=i=>i&&i>I().endOf("day"),G=()=>{var r,u,g;const i=document.querySelector("#clickTrendChart");if(!i)return;let s=[];if((u=(r=l.value)==null?void 0:r.daily_statistics)!=null&&u.length?s=l.value.daily_statistics:(g=C.value)!=null&&g.length&&(s=C.value.slice(0,30)),s.length===0)return;const e=Math.max(...s.map(x=>x.click_count));i.innerHTML=`
    <div class="p-4 h-full">
      <div class="h-full flex items-end space-x-1">
        ${s.map((x,J)=>`
          <div class="flex-1 flex flex-col items-center group">
            <div class="bg-blue-500 w-full rounded-t hover:bg-blue-600 transition-colors cursor-pointer"
                 style="height: ${e>0?x.click_count/e*180:0}px; min-height: 2px;"
                 title="日期: ${x.date}, 点击数: ${x.click_count}">
            </div>
            <div class="text-xs text-gray-500 mt-1 transform rotate-45 origin-bottom-left">
              ${x.date?x.date.slice(5):`第${J+1}天`}
            </div>
            <div class="text-xs text-gray-700 mt-1 opacity-0 group-hover:opacity-100 transition-opacity">
              ${x.click_count}
            </div>
          </div>
        `).join("")}
      </div>
    </div>
  `};return Q(()=>{}),(i,s)=>(p(),L(o(it),{description:"分析短网址的访问数据，了解用户行为和点击趋势",title:"统计分析"},{default:n(()=>[a(o(b),{class:"mb-6",title:"数据筛选"},{default:n(()=>[a(o(ot),null,{default:n(()=>[a(o(H),{value:h.value,"onUpdate:value":s[0]||(s[0]=e=>h.value=e),placeholder:"选择短网址",style:{width:"300px"},"allow-clear":"",onChange:F},{default:n(()=>[(p(!0),k(D,null,$(j.value,e=>(p(),L(o(S),{key:e.id,value:e.id},{default:n(()=>[y(d(e.short_url)+" - "+d(e.title||e.original_url),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),a(o(H),{value:f.value,"onUpdate:value":s[1]||(s[1]=e=>f.value=e),style:{width:"150px"},onChange:O},{default:n(()=>[a(o(S),{value:"7"},{default:n(()=>s[3]||(s[3]=[y("最近7天")])),_:1}),a(o(S),{value:"30"},{default:n(()=>s[4]||(s[4]=[y("最近30天")])),_:1}),a(o(S),{value:"90"},{default:n(()=>s[5]||(s[5]=[y("最近90天")])),_:1}),a(o(S),{value:"365"},{default:n(()=>s[6]||(s[6]=[y("最近一年")])),_:1})]),_:1},8,["value"]),a(o(at),{value:c.value,"onUpdate:value":s[2]||(s[2]=e=>c.value=e),"disabled-date":X,onChange:P},null,8,["value"]),a(o(Z),{onClick:E},{default:n(()=>s[7]||(s[7]=[y("刷新")])),_:1})]),_:1})]),_:1}),a(o(b),{class:"mb-6",title:"全局统计概览"},{default:n(()=>{var e,r,u,g;return[t("div",nt,[t("div",rt,[t("div",dt,[s[9]||(s[9]=t("div",{class:"rounded-lg bg-blue-100 p-2"},[t("svg",{class:"h-6 w-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})])],-1)),t("div",ut,[s[8]||(s[8]=t("p",{class:"text-sm font-medium text-gray-500"},"总短链数",-1)),t("p",ct,d(((e=v.value)==null?void 0:e.total_short_links)||0),1)])])]),t("div",mt,[t("div",pt,[s[11]||(s[11]=t("div",{class:"rounded-lg bg-green-100 p-2"},[t("svg",{class:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.122 2.122"})])],-1)),t("div",vt,[s[10]||(s[10]=t("p",{class:"text-sm font-medium text-gray-500"},"全站总点击",-1)),t("p",gt,d(((r=v.value)==null?void 0:r.total_clicks)||0),1)])])]),t("div",xt,[t("div",ht,[s[13]||(s[13]=t("div",{class:"rounded-lg bg-orange-100 p-2"},[t("svg",{class:"h-6 w-6 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})])],-1)),t("div",ft,[s[12]||(s[12]=t("p",{class:"text-sm font-medium text-gray-500"},"今日点击",-1)),t("p",_t,d(((u=v.value)==null?void 0:u.today_clicks)||0),1)])])]),t("div",kt,[t("div",yt,[s[15]||(s[15]=t("div",{class:"rounded-lg bg-purple-100 p-2"},[t("svg",{class:"h-6 w-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),t("div",bt,[s[14]||(s[14]=t("p",{class:"text-sm font-medium text-gray-500"},"本月点击",-1)),t("p",wt,d(((g=v.value)==null?void 0:g.month_clicks)||0),1)])])])])]}),_:1}),a(o(b),{class:"mb-6",title:"单个短网址统计"},{default:n(()=>{var e,r,u,g;return[h.value?(p(),k("div",St,[t("div",Mt,[t("div",Bt,[s[18]||(s[18]=t("div",{class:"rounded-lg bg-blue-100 p-2"},[t("svg",{class:"h-6 w-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.122 2.122"})])],-1)),t("div",Lt,[s[17]||(s[17]=t("p",{class:"text-sm font-medium text-gray-500"},"总点击数",-1)),t("p",jt,d(((e=l.value)==null?void 0:e.total_clicks)||0),1)])])]),t("div",Vt,[t("div",Tt,[s[20]||(s[20]=t("div",{class:"rounded-lg bg-green-100 p-2"},[t("svg",{class:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"})])],-1)),t("div",zt,[s[19]||(s[19]=t("p",{class:"text-sm font-medium text-gray-500"},"今日点击",-1)),t("p",Dt,d(((r=l.value)==null?void 0:r.today_clicks)||0),1)])])]),t("div",$t,[t("div",It,[s[22]||(s[22]=t("div",{class:"rounded-lg bg-orange-100 p-2"},[t("svg",{class:"h-6 w-6 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})])],-1)),t("div",Nt,[s[21]||(s[21]=t("p",{class:"text-sm font-medium text-gray-500"},"本周点击",-1)),t("p",Rt,d(((u=l.value)==null?void 0:u.week_clicks)||0),1)])])]),t("div",Ht,[t("div",Ut,[s[24]||(s[24]=t("div",{class:"rounded-lg bg-purple-100 p-2"},[t("svg",{class:"h-6 w-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),t("div",qt,[s[23]||(s[23]=t("p",{class:"text-sm font-medium text-gray-500"},"本月点击",-1)),t("p",At,d(((g=l.value)==null?void 0:g.month_clicks)||0),1)])])])])):(p(),k("div",Ct,s[16]||(s[16]=[t("p",null,"请选择一个短网址查看详细统计数据",-1)])))]}),_:1}),t("div",Et,[a(o(b),{title:"点击趋势"},{default:n(()=>{var e,r,u;return[t("div",Ft,[!((r=(e=l.value)==null?void 0:e.daily_statistics)!=null&&r.length)&&!((u=C.value)!=null&&u.length)?(p(),L(o(N),{key:0,description:"暂无数据"})):(p(),k("div",Ot))])]}),_:1}),a(o(b),{title:"热门短网址排行"},{default:n(()=>[a(o(lt),{spinning:_.value},{default:n(()=>[t("div",Pt,[w.value.length===0?(p(),L(o(N),{key:0,description:"暂无排行数据"})):W("",!0),(p(!0),k(D,null,$(w.value,(e,r)=>(p(),k("div",{key:e.id,class:"flex items-center justify-between rounded bg-gray-50 p-3 transition-colors hover:bg-gray-100"},[t("div",Xt,[t("div",Gt,[t("span",Jt,d(r+1),1)]),t("div",Kt,[t("p",Qt,d(e.short_url),1),t("p",Wt,d(e.title||e.original_url),1)])]),t("div",Yt,[t("p",Zt,d(e.click_count),1),s[25]||(s[25]=t("p",{class:"text-xs text-gray-500"},"点击",-1))])]))),128))])]),_:1},8,["spinning"])]),_:1})]),a(o(b),{title:"详细统计数据"},{default:n(()=>{var e;return[t("div",ts,[t("div",null,[s[26]||(s[26]=t("h4",{class:"mb-4 text-lg font-medium"},"每日点击统计",-1)),a(o(U),{columns:q,"data-source":((e=l.value)==null?void 0:e.daily_statistics)||[],pagination:!1,size:"small",scroll:{y:300}},null,8,["data-source"])]),t("div",null,[s[27]||(s[27]=t("h4",{class:"mb-4 text-lg font-medium"},"短链统计数据",-1)),a(o(U),{columns:A,"data-source":C.value||[],pagination:!1,size:"small",scroll:{y:300}},null,8,["data-source"])])])]}),_:1})]),_:1}))}}),Qs=et(ss,[["__scopeId","data-v-b04a732c"]]);export{Qs as default};
